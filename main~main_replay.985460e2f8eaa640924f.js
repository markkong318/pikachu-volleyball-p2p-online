(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return b})),n.d(t,"e",(function(){return N})),n.d(t,"f",(function(){return R})),n.d(t,"c",(function(){return V})),n.d(t,"d",(function(){return F})),n.d(t,"h",(function(){return H})),n.d(t,"g",(function(){return _})),n.d(t,"j",(function(){return W})),n.d(t,"i",(function(){return K}));var i=n(35);n(70);var s=n(25),o=n.n(s),a=n(12),r=n(21),c=n(16),d=n(7),l=n(13),u=n(11),h=n(31),m=n(30),p=n(22),y=n(19),g=n(15);i.initializeApp({apiKey:"AIzaSyDsqSRYwfXyphPMKH9o5YBg9oHIBeZhff8",authDomain:"pikachu-volleyball-d4d22.firebaseapp.com",databaseURL:"https://pikachu-volleyball-d4d22-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"pikachu-volleyball-d4d22",storageBucket:"pikachu-volleyball-d4d22.appspot.com",messagingSenderId:"953416544116",appId:"1:953416544116:web:f4c1f4eee9644a7c004621",measurementId:"G-NHJ6D2SF6Z"});const f=65536,b={isOpen:!1,gameStartAllowed:!1,amICreatedRoom:!1,amIPlayer2:null,isQuickMatch:null,myNickname:"",peerNickname:"",myPartialPublicIP:"*.*.*.*",peerPartialPublicIP:"*.*.*.*",willAskFastAutomatically:!1,peerInputQueue:[],_peerInputQueueSyncCounter:0,get peerInputQueueSyncCounter(){return this._peerInputQueueSyncCounter},set peerInputQueueSyncCounter(e){this._peerInputQueueSyncCounter=Object(r.b)(e,f)},callbackAfterDataChannelOpened:null,callbackAfterDataChannelOpenedForUI:null,callbackAfterPeerInputQueueReceived:null},w={pingSentTimeArray:new Array(5),receivedPingResponseNumber:0,pingMesurementArray:[]};function v(e){return{pendingMessage:"",resendIntervalID:null,_syncCounter:e,_peerSyncCounter:e+(e+1)%2,get syncCounter(){return this._syncCounter},set syncCounter(t){this._syncCounter=e+t%2},get peerSyncCounter(){return this._peerSyncCounter},set peerSyncCounter(t){this._peerSyncCounter=e+t%2},get nextPeerSyncCounter(){return e+(this._peerSyncCounter+1)%2}}}const k=v(0),E=v(2),I=v(4);let C=null,x=null,L=null,S=null;const B=[];let P=null,O=null,D=!1,A=!0,M=!0,T=!0,j=!1;async function N(e){b.amICreatedRoom=!0,L=e;const t=i.firestore();S=t.collection("rooms").doc(L),console.log("Create PeerConnection with configuration: ",h.a),C=new RTCPeerConnection(h.a),X(C),z(S,C,"offerorCandidates","answererCandidates"),x=C.createDataChannel("pikavolley_p2p_channel",{ordered:!1,maxRetransmits:0}),console.log("Created data channel",x),x.addEventListener("open",U),x.addEventListener("message",G),x.addEventListener("close",Q),P=S.onSnapshot(async e=>{console.log("Got updated room:",e.data());const t=e.data();if(!C.currentRemoteDescription&&t.answer){Object(d.q)("Answer received"),console.log("Set remote description");const e=t.answer;await C.setRemoteDescription(e),P(),P=null}});const n=await C.createOffer();await C.setLocalDescription(n),console.log("Created offer and set local description:",n);const s={timestamp:i.firestore.FieldValue.serverTimestamp(),offer:{type:n.type,sdp:n.sdp}};S.set(s),console.log("New room created with SDP offer. Room ID: "+S.id),Object(d.q)("Offer sent")}async function R(e){if(L=e,20!==L.length)return Object(d.t)(),!1;console.log("Join room: ",L);const t=i.firestore().collection("rooms").doc(""+L),n=await t.get();if(console.log("Got room:",n.exists),!n.exists)return console.log("No room is mathing the ID"),b.isQuickMatch?(Object(d.s)(),Object(d.o)()):Object(d.r)(),!1;const s=n.data();if(s.answer)return console.log("The room is already joined by someone else"),Object(d.y)(),!1;console.log("Create PeerConnection with configuration: ",h.a),C=new RTCPeerConnection(h.a),X(C),z(t,C,"answererCandidates","offerorCandidates");const o=s.offer;await C.setRemoteDescription(o),console.log("Set remote description"),Object(d.q)("Offer received");const a=await C.createAnswer();await C.setLocalDescription(a),console.log("set local description:",a);const r={answer:{type:a.type,sdp:a.sdp}};return await t.update(r),Object(d.q)("Answer sent"),console.log("joined room!"),!0}function V(){for(P&&(P(),P=null),O&&(O(),O=null);B.length>0;)B.pop().delete(),console.log("deleted an ICE candidate doc");b.amICreatedRoom&&S&&(S.delete(),S=null,console.log("deleted the room"))}function F(){x&&x.close(),C&&C.close(),console.log("Did close data channel and peer connection")}function H(e){const t=new ArrayBuffer(2+e.length),n=new DataView(t);n.setUint16(0,e[0].syncCounter,!0);for(let t=0;t<e.length;t++){const i=e[t],s=Object(p.b)(i);n.setUint8(2+t,s)}x.send(t)}function _(e){k.pendingMessage=e;const t=e+String(k.syncCounter);x.send(t),k.resendIntervalID=setInterval(()=>x.send(t),1e3)}function W(e){if(!e.speed&&!e.winningScore)return;let t=JSON.stringify(e);t+=String(E.syncCounter),x.send(t),E.resendIntervalID=setInterval(()=>x.send(t),1e3)}function K(e){let t=String(e);t+=String(I.syncCounter),x.send(t),I.resendIntervalID=setInterval(()=>x.send(t),1e3)}function G(e){const t=e.data;if(t instanceof ArrayBuffer){if(t.byteLength>2&&t.byteLength<=2+2*c.c){if(function(e){A&&(A=!1,Object(d.i)());const t=new DataView(e),n=t.getUint16(0,!0);for(let i=0;i<e.byteLength-2;i++){const e=Object(r.b)(n+i,f);if(e===b.peerInputQueueSyncCounter&&(0===b.peerInputQueue.length||Object(r.a)(e,b.peerInputQueue[0].syncCounter,b.peerInputQueue[0].syncCounter+2*c.c-1,f))){const n=t.getUint8(2+i),s=Object(p.a)(n),o=new c.b(e,s.xDirection,s.yDirection,s.powerHit);b.peerInputQueue.push(o),b.peerInputQueueSyncCounter++}}}(t),null!==b.callbackAfterPeerInputQueueReceived){const e=b.callbackAfterPeerInputQueueReceived;b.callbackAfterPeerInputQueueReceived=null,window.setTimeout(e,0)}}else if(1===t.byteLength){const e=new DataView(t).getInt8(0);e>=4?function(e){new DataView(e).getInt8(0)===I.syncCounter&&(I.syncCounter++,clearInterval(I.resendIntervalID))}(t):e>=2?function(e){new DataView(e).getInt8(0)===E.syncCounter&&(E.syncCounter++,clearInterval(E.resendIntervalID))}(t):e>=0?function(e){new DataView(e).getInt8(0)===k.syncCounter&&(k.syncCounter++,clearInterval(k.resendIntervalID),M?M=!1:(Object(u.b)(k.pendingMessage),Object(d.g)()))}(t):e<0&&function(e){const t=new DataView(e);if(-1===t.getInt8(0)){const e=new ArrayBuffer(1);new DataView(e).setInt8(0,-2),console.log("respond to ping"),x.send(e)}else-2===t.getInt8(0)&&(w.pingMesurementArray.push(Date.now()-w.pingSentTimeArray[w.receivedPingResponseNumber]),w.receivedPingResponseNumber++)}(t)}}else if("string"==typeof t){const e=Number(t.slice(-1));e>=4?function(e){const t=Number(e.slice(-1));if(t===I.peerSyncCounter)console.log("arraybuffer with length 1 for options change message ACK resent");else{if(t!==I.nextPeerSyncCounter)return void console.log("invalid options change message received.");{I.peerSyncCounter++;const t="true"===e.slice(0,-1);Object(d.j)(t)}}const n=new ArrayBuffer(1);new DataView(n).setInt8(0,t),x.send(n)}(t):e>=2?function(e){const t=Number(e.slice(-1));if(t===E.peerSyncCounter)console.log("arraybuffer with length 1 for options change message ACK resent");else{if(t!==E.nextPeerSyncCounter)return void console.log("invalid options change message received.");{E.peerSyncCounter++;const t=JSON.parse(e.slice(0,-1));if(t.auto&&"fast"===t.speed&&b.willAskFastAutomatically)return Object(d.b)(),void(j=!0);Object(d.d)(t)}}const n=new ArrayBuffer(1);new DataView(n).setInt8(0,t),x.send(n)}(t):e>=0&&function(e){const t=Number(e.slice(-1));if(t===k.peerSyncCounter)console.log("arraybuffer with length 1 for chat message ACK resent");else{if(t!==k.nextPeerSyncCounter)return void console.log("invalid chat message received.");k.peerSyncCounter++,T?(T=!1,b.peerNickname=e.slice(0,-1).trim().slice(0,d.a),Object(l.a)(b.peerNickname,b.amICreatedRoom),Object(l.a)(b.myNickname,!b.amICreatedRoom),Object(l.b)(b.peerPartialPublicIP,b.amICreatedRoom),Object(l.b)(b.myPartialPublicIP,!b.amICreatedRoom),b.amICreatedRoom?(g.a.recordNicknames(b.myNickname,b.peerNickname),g.a.recordPartialPublicIPs(b.myPartialPublicIP,b.peerPartialPublicIP)):(g.a.recordNicknames(b.peerNickname,b.myNickname),g.a.recordPartialPublicIPs(b.peerPartialPublicIP,b.myPartialPublicIP))):Object(u.c)(e.slice(0,-1))}const n=new ArrayBuffer(1);new DataView(n).setInt8(0,t),x.send(n)}(t)}}function U(){Object(d.q)("data channel opened!"),console.log("data channel opened!"),console.log("dataChannel.ordered: "+x.ordered),console.log("dataChannel.maxRetransmits: "+x.maxRetransmits),x.binaryType="arraybuffer",b.isOpen=!0,D=!0,Object(d.l)(),V(),b.isQuickMatch&&Object(d.f)(),b.amICreatedRoom&&(b.isQuickMatch?Object(y.c)():Object(y.d)()),g.a.recordRoomID(L);const e=o.a.alea(L.slice(10));Object(a.b)(e);const t=o.a.alea(L.slice(10,15)),n=o.a.alea(L.slice(15));Object(u.f)(t,n),function(){_(b.myNickname),b.willAskFastAutomatically&&Object(d.e)(!j),Object(d.q)("start ping test");const e=new ArrayBuffer(1);new DataView(e).setInt8(0,-1);let t=0;const n=setInterval(()=>{if(5!==t)w.pingSentTimeArray[t]=Date.now(),x.send(e),Object(d.v)(),t++;else{window.clearInterval(n);const e=w.pingMesurementArray.reduce((e,t)=>e+t,0)/w.pingMesurementArray.length;console.log(`average ping: ${e} ms, ping list: ${w.pingMesurementArray}`),b.callbackAfterDataChannelOpened(),b.callbackAfterDataChannelOpenedForUI(),Object(d.C)(),Object(d.g)(),Object(d.m)(e);let t=10;Object(d.z)(t);const i=setInterval(()=>{if(t--,Object(d.z)(t),0===t)return window.clearInterval(i),Object(d.h)(),void(b.gameStartAllowed=!0)},1e3)}},1e3)}()}function Q(){console.log("data channel closed"),b.isOpen=!1,Object(d.k)()}function X(e){e.addEventListener("icegatheringstatechange",()=>{console.log("ICE gathering state changed: "+e.iceGatheringState),Object(d.q)("ICE gathering state changed: "+e.iceGatheringState)}),e.addEventListener("connectionstatechange",()=>{console.log("Connection state change: "+e.connectionState),Object(d.q)("Connection state change: "+e.connectionState),"disconnected"!==e.connectionState&&"closed"!==e.connectionState||(b.isOpen=!1,Object(d.k)()),"failed"===e.connectionState&&!1===D&&(Object(d.l)(),Object(d.o)())}),e.addEventListener("signalingstatechange",()=>{console.log("Signaling state change: "+e.signalingState),Object(d.q)("Signaling state change: "+e.signalingState)}),e.addEventListener("iceconnectionstatechange ",()=>{console.log("ICE connection state change: "+e.iceConnectionState),Object(d.q)("ICE connection state change: "+e.iceConnectionState)}),e.addEventListener("datachannel",e=>{x=e.channel,console.log("data channel received!",x),Object(d.q)("data channel received!"),x.addEventListener("open",U),x.addEventListener("message",G),x.addEventListener("close",Q)})}function z(e,t,n,i){const s=e.collection(n);t.addEventListener("icecandidate",e=>{if(!e.candidate)return void console.log("Got final candidate!");const t=e.candidate.toJSON();if(s.add(t).then(e=>B.push(e)),console.log("Got candidate: ",e.candidate),""===e.candidate.candidate)return;const n=Object(m.c)(e.candidate.candidate);null!==n&&(b.myPartialPublicIP=Object(m.a)(n),console.log("part of my public IP address:",b.myPartialPublicIP))}),O=e.collection(i).onSnapshot(e=>{e.docChanges().forEach(async e=>{if("added"===e.type){const n=e.doc.data();if(await t.addIceCandidate(n),console.log("Got new remote ICE candidate"),""===n.candidate)return;const i=Object(m.c)(n.candidate);null!==i&&(b.peerPartialPublicIP=Object(m.a)(i),console.log("part of the peer's public IP address:",b.peerPartialPublicIP))}})})}},,function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"A",(function(){return O})),n.d(t,"B",(function(){return D})),n.d(t,"f",(function(){return M})),n.d(t,"n",(function(){return T})),n.d(t,"x",(function(){return j})),n.d(t,"p",(function(){return N})),n.d(t,"w",(function(){return R})),n.d(t,"u",(function(){return V})),n.d(t,"q",(function(){return H})),n.d(t,"v",(function(){return _})),n.d(t,"t",(function(){return W})),n.d(t,"r",(function(){return K})),n.d(t,"s",(function(){return G})),n.d(t,"y",(function(){return U})),n.d(t,"o",(function(){return Q})),n.d(t,"C",(function(){return X})),n.d(t,"h",(function(){return z})),n.d(t,"m",(function(){return q})),n.d(t,"z",(function(){return $})),n.d(t,"i",(function(){return Y})),n.d(t,"j",(function(){return J})),n.d(t,"d",(function(){return ee})),n.d(t,"k",(function(){return te})),n.d(t,"c",(function(){return ne})),n.d(t,"g",(function(){return ie})),n.d(t,"l",(function(){return se})),n.d(t,"e",(function(){return oe})),n.d(t,"b",(function(){return ae}));var i=n(61),s=n.n(i),o=n(5);const a=function(){const e="23456789abcdefghijkmnpqrstuvwxyz";let t=0;const n=[];return function(){let i=Date.now();const s=i===t;t=i;const o=new Array(10);for(let t=9;t>=0;t--)o[t]=e.charAt(i%32),i=Math.floor(i/32);if(0!==i)throw new Error("We should have converted the entire timestamp.");let a=o.join("");if(s){let e;for(e=9;e>=0&&31===n[e];e--)n[e]=0;n[e]++}else for(let e=0;e<10;e++)n[e]=Math.floor(32*Math.random());for(let t=0;t<10;t++)a+=e.charAt(n[t]);if(20!==a.length)throw new Error("Length should be 20.");return a}}();var r=n(16),c=n(30),d=n(31);let l=null,u=null;async function h(e,t,n,i,s){l=new RTCPeerConnection(d.a);let o=!1,a=!1,r=!1,h=!1;const m=[];l.addEventListener("icecandidate",d=>{if(!d.candidate){if(console.log("Got final candidate!"),u&&u.close(),l&&l.close(),1===Object.keys(m).length){var p=m[Object.keys(m)[0]];h=1!==p.length,console.log(h?"symmetric nat":"normal nat")}return r||a?h?(console.log("behind symmetric nat"),s()):(a||r&&!h)&&(console.log('"host address is public IP" or "got srflx, not behind symmetric nat"'),t()):(console.log("did not get srflx"),o?(console.log("host address is obfuscted"),i()):(console.log("host address is not obfuscated"),n())),void e()}if(""===d.candidate.candidate)return;const y=Object(c.b)(d.candidate.candidate);if("srflx"===y.type)r=!0,m[y.relatedPort]?m[y.relatedPort][0]!==y.port&&m[y.relatedPort].push(y.port):m[y.relatedPort]=[y.port];else if("host"===y.type)if(y.ip.endsWith(".local"))o=!0;else{RegExp("(^127.)|(^10.)|(^172.1[6-9].)|(^172.2[0-9].)|(^172.3[0-1].)|(^192.168.)").test(y.ip)||(a=!0)}console.log("Got candidate: ",d.candidate)}),u=l.createDataChannel("test",{ordered:!0,maxRetransmits:0});const p=await l.createOffer();await l.setLocalDescription(p)}var m=n(19),p=n(11),y=n(15),g=n(41);n(37);const f=8,b={bgm:"on",sfx:"stereo",speed:"medium",winningScore:15};let w=e=>{me(e),e.bgm&&(b.bgm=e.bgm),e.sfx&&(b.sfx=e.sfx),e.speed&&(b.speed=e.speed),e.winningScore&&(b.winningScore=e.winningScore)};const v={toSend:null,received:null};let k=null,E=null,I=!1;const C=document.getElementById("chat-open-btn-and-chat-disabling-btn-container"),x=document.getElementById("chat-open-btn"),L=document.getElementById("chat-disabling-btn"),S=document.getElementById("chat-input-and-send-btn-container"),B=document.getElementById("chat-input"),P=document.getElementById("send-btn");function O(){r.d.unsubscribe();const e=document.getElementById("network-test-btn"),t=document.getElementById("quick-match-btn"),n=document.getElementById("with-your-friend-btn"),i=document.getElementById("create-btn"),s=document.getElementById("copy-btn"),c=document.getElementById("join-btn"),d=document.getElementById("join-room-id-input"),l=()=>{e.disabled=!0,t.disabled=!0,n.disabled=!0,i.disabled=!0,c.disabled=!0,d.disabled=!0},u=()=>{e.disabled=!1,document.getElementById("about-with-your-friend").classList.contains("hidden")&&(t.disabled=!1),n.disabled=!1,i.disabled=!1,c.disabled=!1,d.disabled=!1};e.addEventListener("click",()=>{l();h(u,()=>{document.getElementById("test-passed").classList.remove("hidden")},()=>{document.getElementById("did-not-get-srflx-candidate").classList.remove("hidden")},()=>{document.getElementById("did-not-get-srflx-candidate-and-host-address-is-obfuscated").classList.remove("hidden")},()=>{document.getElementById("behind-symmetric-nat").classList.remove("hidden")})});const g=document.getElementById("nickname-input");let b=null;try{b=window.localStorage.getItem("myNickname")}catch(e){console.log(e)}null!==b?(o.b.myNickname=b.trim().slice(0,f),g.value=o.b.myNickname):o.b.myNickname=g.value,g.addEventListener("input",e=>{o.b.myNickname=e.target.value.trim().slice(0,f),g.value=o.b.myNickname;try{window.localStorage.setItem("myNickname",o.b.myNickname)}catch(e){console.log(e)}});const I=document.getElementById("auto-fast-speed-checkbox");let O=null;try{O="true"===window.localStorage.getItem("willAskFastAutomatically")}catch(e){console.log(e)}null!==O?(o.b.willAskFastAutomatically=O,I.checked=O):o.b.willAskFastAutomatically=I.checked,I.addEventListener("change",()=>{o.b.willAskFastAutomatically=I.checked;try{window.localStorage.setItem("willAskFastAutomatically",String(o.b.willAskFastAutomatically))}catch(e){console.log(e)}});const D=document.getElementById("auto-save-replay-checkbox");try{E="true"===window.localStorage.getItem("willSaveReplayAutomatically")}catch(e){console.log(e)}null!==E?D.checked=E:E=D.checked,D.addEventListener("change",()=>{E=D.checked;try{window.localStorage.setItem("willSaveReplayAutomatically",String(E))}catch(e){console.log(e)}});let M=null;try{M=window.localStorage.getItem("bgm")}catch(e){console.log(e)}null!==M&&w({bgm:M});let T=null;try{T=window.localStorage.getItem("sfx")}catch(e){console.log(e)}null!==T&&w({sfx:T});const j=e=>{if("Enter"===e.code||"KeyZ"===e.code){e.preventDefault(),window.removeEventListener("keydown",j);const t=document.getElementById("press-enter-to-quick-match");t.classList.contains("hidden")||t.classList.add("hidden");h(()=>{},()=>{document.getElementById("quick-match-notice-box").classList.remove("hidden");const e=a();Object(m.e)(e)},()=>{document.getElementById("did-not-get-srflx-candidate").classList.remove("hidden"),u()},()=>{document.getElementById("did-not-get-srflx-candidate-and-host-address-is-obfuscated").classList.remove("hidden"),u()},()=>{document.getElementById("behind-symmetric-nat").classList.remove("hidden"),u()})}};t.addEventListener("click",()=>{l(),o.b.isQuickMatch=!0,window.addEventListener("keydown",j);document.getElementById("press-enter-to-quick-match").classList.remove("hidden")});const N=e=>{"Enter"===e.code&&(e.preventDefault(),window.removeEventListener("keydown",N),t.click())};window.addEventListener("keydown",N),i.addEventListener("click",()=>{l(),document.getElementById("join-room-id-input").value="",o.b.isQuickMatch=!1;const e=a();Object(o.e)(e).then(()=>{A(e),s.classList.remove("hidden")})}),s.addEventListener("click",()=>{s.innerHTML=document.getElementById("copied").innerHTML,setTimeout(()=>{s.textContent=document.getElementById("copy").textContent},700),navigator.clipboard.writeText(document.getElementById("current-room-id").textContent)});const R=e=>{"Enter"===e.code&&(e.preventDefault(),window.removeEventListener("keydown",R),c.click())};c.addEventListener("click",()=>{l(),o.b.isQuickMatch=!1;const e=document.getElementById("join-room-id-input").value.trim().split("-").join("");Object(o.f)(e).then(t=>{t?A(e):(u(),window.addEventListener("keydown",R))})}),n.addEventListener("click",()=>{const e=document.getElementById("about-with-your-friend");e.classList.contains("hidden")?(e.classList.remove("hidden"),t.disabled=!0,window.addEventListener("keydown",R)):(e.classList.add("hidden"),t.disabled=!1,window.removeEventListener("keydown",R))}),window.addEventListener("keydown",e=>{if("Escape"===e.code){const t=document.getElementById("menu-bar");t.classList.contains("hidden")?t.classList.remove("hidden"):t.classList.add("hidden"),e.preventDefault()}}),x.addEventListener("click",le),P.addEventListener("click",ue),o.b.callbackAfterDataChannelOpenedForUI=()=>{window.addEventListener("keydown",e=>{"Space"===e.code?C.classList.contains("hidden")||(e.preventDefault(),x.click()):"Enter"===e.code&&e.preventDefault()}),window.addEventListener("keyup",e=>{"Enter"===e.code&&(S.classList.contains("hidden")||window.setTimeout(()=>P.click(),0))})},L.addEventListener("click",()=>{x.disabled?(Object(p.d)(!0),x.disabled=!1,L.textContent=document.getElementById("text-disable-chat").textContent,L.blur()):(Object(p.d)(!1),x.disabled=!0,B.disabled=!0,P.disabled=!0,L.textContent=document.getElementById("text-enable-chat").textContent,L.blur())}),he("test-passed-ok-btn","test-passed"),he("did-not-get-srflx-candidate-ok-btn","did-not-get-srflx-candidate"),he("did-not-get-srflx-candidate-and-host-address-is-obfuscated-ok-btn","did-not-get-srflx-candidate-and-host-address-is-obfuscated"),he("behind-symmetric-nat-ok-btn","behind-symmetric-nat");document.getElementById("cancel-quick-match-btn").addEventListener("click",()=>{const e=document.getElementById("press-enter-to-quick-match");e.classList.contains("hidden")||e.classList.add("hidden"),u()});document.getElementById("cancel-quick-match-btn-2").addEventListener("click",()=>{Object(m.b)(),Object(o.c)(),window.setTimeout(()=>location.reload(),0)});document.getElementById("notice-disconnected-ok-btn").addEventListener("click",()=>{window.setTimeout(()=>location.reload(),0)});document.getElementById("ask-one-more-game-yes-btn").addEventListener("click",()=>{const e=document.getElementById("ask-one-more-game");e.classList.contains("hidden")||e.classList.add("hidden")});document.getElementById("ask-one-more-game-no-btn").addEventListener("click",()=>{window.setTimeout(()=>location.reload(),0)}),window.addEventListener("unload",o.d),window.addEventListener("beforeunload",(function(e){Object(o.c)(),o.b.isOpen&&(E&&!document.getElementById("flex-container").classList.contains("hidden")&&y.a.saveAsFile(),e.preventDefault(),e.returnValue="")})),de(),function(){const e=document.getElementById("bgm-on-btn"),t=document.getElementById("bgm-off-btn");e.addEventListener("click",()=>{w({bgm:"on"})}),t.addEventListener("click",()=>{w({bgm:"off"})});const n=document.getElementById("stereo-btn"),i=document.getElementById("mono-btn"),s=document.getElementById("sfx-off-btn");function o(){return!!k&&(k.state!==k.intro&&k.state!==k.menu&&!(k.state===k.round&&k.gameEnded))}n.addEventListener("click",()=>{w({sfx:"stereo"})}),i.addEventListener("click",()=>{w({sfx:"mono"})}),s.addEventListener("click",()=>{w({sfx:"off"})});const a=document.getElementById("slow-speed-btn"),r=document.getElementById("medium-speed-btn"),c=document.getElementById("fast-speed-btn"),d=document.getElementById("notice-speed-options-cannot-changed-if-game-in-progress"),l=document.getElementById("notice-speed-options-cannot-changed-if-game-in-progress-ok-btn");a.addEventListener("click",()=>{if(!a.classList.contains("selected"))return o()?(d.classList.remove("hidden"),void ce()):void Z({speed:"slow",winningScore:null})}),r.addEventListener("click",()=>{if(!r.classList.contains("selected"))return o()?(d.classList.remove("hidden"),void ce()):void Z({speed:"medium",winningScore:null})}),c.addEventListener("click",()=>{if(!c.classList.contains("selected"))return o()?(d.classList.remove("hidden"),void ce()):void Z({speed:"fast",winningScore:null})}),l.addEventListener("click",()=>{d.classList.contains("hidden")||(d.classList.add("hidden"),re())});const u=document.getElementById("winning-score-5-btn"),h=document.getElementById("winning-score-10-btn"),m=document.getElementById("winning-score-15-btn"),p=document.getElementById("notice-winning-score-options-cannot-changed-if-game-in-progress"),y=document.getElementById("notice-winning-score-options-cannot-changed-if-game-in-progress-ok-btn");u.addEventListener("click",()=>{if(!u.classList.contains("selected"))return o()?(p.classList.remove("hidden"),void ce()):void Z({speed:null,winningScore:5})}),h.addEventListener("click",()=>{if(!h.classList.contains("selected"))return o()?(p.classList.remove("hidden"),void ce()):void Z({speed:null,winningScore:10})}),m.addEventListener("click",()=>{if(!m.classList.contains("selected"))return o()?(p.classList.remove("hidden"),void ce()):void Z({speed:null,winningScore:15})}),y.addEventListener("click",()=>{p.classList.contains("hidden")||(p.classList.add("hidden"),re())})}(),window.addEventListener("click",e=>{e.target.matches(".dropdown-btn, .submenu-btn")||(ge(),ye(""))}),document.getElementById("options-dropdown-btn").addEventListener("click",()=>{var e;e="options-dropdown",ge(),ye(e),document.getElementById(e).classList.toggle("show")}),document.getElementById("bgm-submenu-btn").addEventListener("mouseover",()=>{pe("bgm-submenu-btn","bgm-submenu")}),document.getElementById("sfx-submenu-btn").addEventListener("mouseover",()=>{pe("sfx-submenu-btn","sfx-submenu")}),document.getElementById("speed-submenu-btn").addEventListener("mouseover",()=>{pe("speed-submenu-btn","speed-submenu")}),document.getElementById("winning-score-submenu-btn").addEventListener("mouseover",()=>{pe("winning-score-submenu-btn","winning-score-submenu")}),document.getElementById("bgm-submenu-btn").addEventListener("click",()=>{pe("bgm-submenu-btn","bgm-submenu")}),document.getElementById("sfx-submenu-btn").addEventListener("click",()=>{pe("sfx-submenu-btn","sfx-submenu")}),document.getElementById("speed-submenu-btn").addEventListener("click",()=>{pe("speed-submenu-btn","speed-submenu")}),document.getElementById("winning-score-submenu-btn").addEventListener("click",()=>{pe("winning-score-submenu-btn","winning-score-submenu")}),function(){const e=document.getElementById("ask-options-change-send-to-peer"),t=document.getElementById("ask-options-change-send-to-peer-yes-btn"),n=document.getElementById("ask-options-change-send-to-peer-no-btn");t.addEventListener("click",()=>{Object(o.j)(v.toSend),e.classList.contains("hidden")||e.classList.add("hidden")}),n.addEventListener("click",()=>{e.classList.contains("hidden")||e.classList.add("hidden"),re()});const i=document.getElementById("ask-options-change-received-from-peer"),s=document.getElementById("ask-options-change-received-from-peer-yes-btn"),a=document.getElementById("ask-options-change-received-from-peer-no-btn");s.addEventListener("click",()=>{i.classList.contains("hidden")||i.classList.add("hidden"),Object(o.i)(!0),w(v.received),re()}),a.addEventListener("click",()=>{i.classList.contains("hidden")||i.classList.add("hidden"),Object(o.i)(!1),re()});const r=document.getElementById("notice-peer-agreed");document.getElementById("notice-peer-agreed-ok-btn").addEventListener("click",()=>{r.classList.contains("hidden")||r.classList.add("hidden"),re()});const c=document.getElementById("notice-peer-disagreed");document.getElementById("notice-peer-disagreed-ok-btn").addEventListener("click",()=>{c.classList.contains("hidden")||c.classList.add("hidden"),re()})}();document.getElementById("save-replay-btn").addEventListener("click",()=>{y.a.saveAsFile()});document.getElementById("exit-btn").addEventListener("click",()=>{location.reload()})}function D(e,t){k=e,w=n=>{if(me(n),y.a.recordOptions(n),n.bgm){switch(n.bgm){case"on":e.audio.turnBGMVolume(!0);break;case"off":e.audio.turnBGMVolume(!1)}try{window.localStorage.setItem("bgm",n.bgm)}catch(e){console.log(e)}}if(n.sfx){switch(n.sfx){case"stereo":e.audio.turnSFXVolume(!0),e.isStereoSound=!0;break;case"mono":e.audio.turnSFXVolume(!0),e.isStereoSound=!1;break;case"off":e.audio.turnSFXVolume(!1)}try{window.localStorage.setItem("sfx",n.sfx)}catch(e){console.log(e)}}if(n.speed)switch(n.speed){case"slow":e.normalFPS=20,t.maxFPS=e.normalFPS;break;case"medium":e.normalFPS=25,t.maxFPS=e.normalFPS;break;case"fast":e.normalFPS=30,t.maxFPS=e.normalFPS}if(n.winningScore)switch(n.winningScore){case 5:e.winningScore=5;break;case 10:e.winningScore=10;break;case 15:e.winningScore=15}},w(b)}function A(e){const t=`${e.slice(0,5)}-${e.slice(5,10)}-${e.slice(10,15)}-${e.slice(15)}`;if(document.getElementById("current-room-id").textContent=t,Object(g.a)()){const e=`${window.location.href}?partyId=${t}`;H("Share this link to your friend:",F),H(`<div class="allow-copy">${e}<span onclick="navigator.share&&navigator.share({title:'Pikachu Volleyball',text:'Let\\&apos;s play the game',url:'${e}'})"><img src="./img/share.png"></span></div>`,F),function(e){let t="connection-log-with-friend";o.b.isQuickMatch&&(t="connection-log-quick-match");const n=document.getElementById(t),i=document.createElement("canvas");s.a.toCanvas(i,e),n.appendChild(i)}(e)}}function M(){document.getElementById("cancel-quick-match-btn-2").disabled=!0}function T(e){document.getElementById("communication-count").textContent=String(e)}function j(e){let t="";switch(e){case m.a.createRoom:t=document.getElementById("waiting-message").textContent;break;case m.a.keepWait:return;case m.a.waitPeerConnection:t=document.getElementById("waiting-peer-to-connect-message").textContent;break;case m.a.connectToPeerAfterAWhile:t=document.getElementById("connect-to-peer-after-a-while-message").textContent;break;case m.a.connectToPeer:t=document.getElementById("connect-to-peer-message").textContent;break;case m.a.abandoned:t=document.getElementById("abandoned-message").textContent;break;default:return}R(t)}function N(){R(document.getElementById("failed-to-connect-to-server").textContent)}function R(e){const t=document.getElementById("quick-match-log");t.textContent+=e+"\n",t.scrollIntoView()}function V(e,t,n){document.getElementById("within-24-hours").textContent=String(e),document.getElementById("within-1-hour").textContent=String(t),document.getElementById("within-10-minutes").textContent=String(n)}const F="#000000";function H(e,t="#CCCCCC"){let n="connection-log-with-friend";o.b.isQuickMatch&&(n="connection-log-quick-match");const i=document.getElementById(n),s=document.createElement("div");s.innerHTML=""+e,s.style.color=t,i.appendChild(s)}function _(){let e="connection-log-with-friend";o.b.isQuickMatch&&(e="connection-log-quick-match");const t=document.getElementById(e),n=document.createElement("span");n.innerHTML=".",t.appendChild(n)}function W(){H(document.getElementById("not-valid-room-id-message").textContent,"#A62424")}function K(){H(document.getElementById("no-room-matching-message").textContent,"#A62424")}function G(){H(document.getElementById("no-room-matching-message-in-quick-match").textContent,"#A62424")}function U(){H(document.getElementById("someone-esle-already-joined-the-room").textContent,"#A62424")}function Q(){H(document.getElementById("connection-failed").textContent,"#A62424")}function X(){const e=document.getElementById("flex-container"),t=document.getElementById("before-connection"),n=document.getElementById("quick-match-notice-box");n.classList.contains("hidden")||n.classList.add("hidden"),t.classList.contains("hidden")||t.classList.add("hidden"),e.classList.remove("hidden"),r.d.subscribe()}function z(){const e=document.getElementById("ping-box");e.classList.contains("hidden")||e.classList.add("hidden")}function q(e){document.getElementById("average-ping").textContent=String(e)}function $(e){document.getElementById("starts-in").textContent=String(e)}function Y(){const e=document.getElementById("peer-loading-box");e.classList.contains("hidden")||e.classList.add("hidden")}function J(e){if(e){w(v.toSend);document.getElementById("notice-peer-agreed").classList.remove("hidden")}else{document.getElementById("notice-peer-disagreed").classList.remove("hidden")}}function Z(e){const t=document.getElementById("options-change-to-send");if(e.speed)switch(t.textContent=document.getElementById("speed-submenu-btn").textContent.trim()+" ",e.speed){case"slow":t.textContent+=document.getElementById("slow-speed-btn").textContent.replace("✓","").trim();break;case"medium":t.textContent+=document.getElementById("medium-speed-btn").textContent.replace("✓","").trim();break;case"fast":t.textContent+=document.getElementById("fast-speed-btn").textContent.replace("✓","").trim()}else{if(!e.winningScore)return;switch(t.textContent=document.getElementById("winning-score-submenu-btn").textContent.trim()+" ",e.winningScore){case 5:t.textContent+=document.getElementById("winning-score-5-btn").textContent.replace("✓","").trim();break;case 10:t.textContent+=document.getElementById("winning-score-10-btn").textContent.replace("✓","").trim();break;case 15:t.textContent+=document.getElementById("winning-score-15-btn").textContent.replace("✓","").trim()}}v.toSend=e,document.getElementById("ask-options-change-send-to-peer").classList.remove("hidden"),ce()}function ee(e){const t=document.getElementById("options-change-received");if(e.speed)switch(t.textContent=document.getElementById("speed-submenu-btn").textContent.trim()+" ",e.speed){case"slow":t.textContent+=document.getElementById("slow-speed-btn").textContent.replace("✓","").trim();break;case"medium":t.textContent+=document.getElementById("medium-speed-btn").textContent.replace("✓","").trim();break;case"fast":t.textContent+=document.getElementById("fast-speed-btn").textContent.replace("✓","").trim()}else{if(!e.winningScore)return;switch(t.textContent=document.getElementById("winning-score-submenu-btn").textContent.trim()+" ",e.winningScore){case 5:t.textContent+=document.getElementById("winning-score-5-btn").textContent.replace("✓","").trim();break;case 10:t.textContent+=document.getElementById("winning-score-10-btn").textContent.replace("✓","").trim();break;case 15:t.textContent+=document.getElementById("winning-score-15-btn").textContent.replace("✓","").trim()}}v.received=e,document.getElementById("ask-options-change-received-from-peer").classList.remove("hidden"),ce(),ge(),ye("")}function te(){!E||document.getElementById("flex-container").classList.contains("hidden")||I||(y.a.saveAsFile(),I=!0),document.getElementById("notice-disconnected").classList.remove("hidden")}function ne(){document.getElementById("ask-one-more-game").classList.remove("hidden")}function ie(){x.disabled=!1,L.disabled=!1}function se(){document.getElementById("audio-pikachu-sound").play()}function oe(e){v.toSend={auto:!0,speed:"fast",winningScore:null},e&&ce(),Object(o.j)(v.toSend)}function ae(){w({speed:"fast",winningScore:null}),re()}function re(){document.getElementById("options-dropdown-btn").disabled=!1}function ce(){document.getElementById("options-dropdown-btn").disabled=!0}function de(){x.disabled=!0,L.disabled=!0,B.disabled=!0,P.disabled=!0}function le(){x.disabled=!0,B.disabled=!1,P.disabled=!1,r.d.unsubscribe(),C.classList.contains("hidden")||C.classList.add("hidden"),S.classList.remove("hidden"),B.focus({preventScroll:!0})}function ue(){de(),r.d.subscribe(),S.classList.contains("hidden")||S.classList.add("hidden"),C.classList.remove("hidden");const e=B.value;""!==e?(B.value="",Object(o.g)(e)):ie()}function he(e,t){document.getElementById(e).addEventListener("click",()=>{const e=document.getElementById(t);e.classList.contains("hidden")||e.classList.add("hidden")})}function me(e){if(e.bgm){const t=document.getElementById("bgm-on-btn"),n=document.getElementById("bgm-off-btn");switch(e.bgm){case"on":n.classList.remove("selected"),t.classList.add("selected");break;case"off":t.classList.remove("selected"),n.classList.add("selected")}}if(e.sfx){const t=document.getElementById("stereo-btn"),n=document.getElementById("mono-btn"),i=document.getElementById("sfx-off-btn");switch(e.sfx){case"stereo":n.classList.remove("selected"),i.classList.remove("selected"),t.classList.add("selected");break;case"mono":i.classList.remove("selected"),t.classList.remove("selected"),n.classList.add("selected");break;case"off":t.classList.remove("selected"),n.classList.remove("selected"),i.classList.add("selected")}}if(e.speed){const t=document.getElementById("slow-speed-btn"),n=document.getElementById("medium-speed-btn"),i=document.getElementById("fast-speed-btn");switch(e.speed){case"slow":n.classList.remove("selected"),i.classList.remove("selected"),t.classList.add("selected");break;case"medium":i.classList.remove("selected"),t.classList.remove("selected"),n.classList.add("selected");break;case"fast":t.classList.remove("selected"),n.classList.remove("selected"),i.classList.add("selected")}}if(e.winningScore){const t=document.getElementById("winning-score-5-btn"),n=document.getElementById("winning-score-10-btn"),i=document.getElementById("winning-score-15-btn");switch(e.winningScore){case 5:n.classList.remove("selected"),i.classList.remove("selected"),t.classList.add("selected");break;case 10:i.classList.remove("selected"),t.classList.remove("selected"),n.classList.add("selected");break;case 15:t.classList.remove("selected"),n.classList.remove("selected"),i.classList.add("selected")}}}function pe(e,t){ge(),document.getElementById(e).classList.add("open"),document.getElementById(t).classList.add("show")}function ye(e){const t=document.getElementsByClassName("dropdown");for(let n=0;n<t.length;n++)t[n].id!==e&&t[n].classList.remove("show")}function ge(){const e=document.getElementsByClassName("submenu");for(let t=0;t<e.length;t++)e[t].classList.remove("show");const t=document.getElementsByClassName("submenu-btn");for(let e=0;e<t.length;e++)t[e].classList.remove("open")}},,function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i={SPRITE_SHEET:"../resources/assets/images/sprite_sheet.json",TEXTURES:{},SOUNDS:{}},s=i.TEXTURES;s.PIKACHU=(e,t)=>`pikachu/pikachu_${e}_${t}.png`,s.BALL=e=>`ball/ball_${e}.png`,s.NUMBER=e=>`number/number_${e}.png`,s.SKY_BLUE="objects/sky_blue.png",s.MOUNTAIN="objects/mountain.png",s.GROUND_RED="objects/ground_red.png",s.GROUND_LINE="objects/ground_line.png",s.GROUND_LINE_LEFT_MOST="objects/ground_line_leftmost.png",s.GROUND_LINE_RIGHT_MOST="objects/ground_line_rightmost.png",s.GROUND_YELLOW="objects/ground_yellow.png",s.NET_PILLAR_TOP="objects/net_pillar_top.png",s.NET_PILLAR="objects/net_pillar.png",s.SHADOW="objects/shadow.png",s.BALL_HYPER="ball/ball_hyper.png",s.BALL_TRAIL="ball/ball_trail.png",s.BALL_PUNCH="ball/ball_punch.png",s.CLOUD="objects/cloud.png",s.WAVE="objects/wave.png",s.SACHISOFT="messages/common/sachisoft.png",s.READY="messages/common/ready.png",s.GAME_END="messages/common/game_end.png",s.MARK="messages/ja/mark.png",s.POKEMON="messages/ja/pokemon.png",s.PIKACHU_VOLLEYBALL="messages/ja/pikachu_volleyball.png",s.FIGHT="messages/ja/fight.png",s.WITH_COMPUTER="messages/ja/with_computer.png",s.WITH_FRIEND="messages/ja/with_friend.png",s.GAME_START="messages/ja/game_start.png",s.SITTING_PIKACHU="sitting_pikachu.png";const o=i.SOUNDS;o.BGM="../resources/assets/sounds/bgm.mp3",o.PIPIKACHU="../resources/assets/sounds/WAVE140_1.wav",o.PIKA="../resources/assets/sounds/WAVE141_1.wav",o.CHU="../resources/assets/sounds/WAVE142_1.wav",o.PI="../resources/assets/sounds/WAVE143_1.wav",o.PIKACHU="../resources/assets/sounds/WAVE144_1.wav",o.POWERHIT="../resources/assets/sounds/WAVE145_1.wav",o.BALLTOUCHESGROUND="../resources/assets/sounds/WAVE146_1.wav"},,function(e,t,n){"use strict";n.d(t,"g",(function(){return h})),n.d(t,"f",(function(){return m})),n.d(t,"d",(function(){return p})),n.d(t,"e",(function(){return y})),n.d(t,"b",(function(){return g})),n.d(t,"c",(function(){return f})),n.d(t,"a",(function(){return b}));var i=n(5),s=n(15);let o=null,a=null,r=null,c=!0;const d=document.getElementById("game-canvas-container");let l=document.getElementById("player1-chat-box"),u=document.getElementById("player2-chat-box");function h(e){o=()=>document.querySelectorAll(".fade-in-box:not(.hidden)").length>0||(e.state===e.intro||e.state===e.menu)}function m(e,t){a=e,r=t}function p(e){c=e}function y(){l.classList.contains("hidden")||l.classList.add("hidden"),u.classList.contains("hidden")||u.classList.add("hidden")}function g(e){null===i.b.amIPlayer2?i.b.amICreatedRoom?b(e,1):b(e,2):!1===i.b.amIPlayer2?b(e,1):!0===i.b.amIPlayer2&&b(e,2)}function f(e){null===i.b.amIPlayer2?i.b.amICreatedRoom?b(e,2):b(e,1):!1===i.b.amIPlayer2?b(e,2):!0===i.b.amIPlayer2&&b(e,1)}function b(e,t){if(c)if(s.a.recordChats(e,t),1===t){const t=l.cloneNode();t.textContent=e,t.style.top=20+30*a()+"%",t.style.right=55+25*a()+"%",t.classList.remove("hidden"),o&&!o()?t.classList.remove("in-speech-bubble"):t.classList.contains("in-speech-bubble")||t.classList.add("in-speech-bubble"),d.replaceChild(t,l),l=t}else if(2===t){const t=u.cloneNode();t.textContent=e,t.style.top=20+30*r()+"%",t.style.left=55+25*r()+"%",t.classList.remove("hidden"),o&&!o()?t.classList.remove("in-speech-bubble"):t.classList.contains("in-speech-bubble")||t.classList.add("in-speech-bubble"),d.replaceChild(t,u),u=t}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return o}));let i=null;function s(){return null===i?Math.floor(32768*Math.random()):Math.floor(32768*i())}function o(e){i=e}},function(e,t,n){"use strict";function i(e,t){let n=null;n=t?document.getElementById("player2-nickname"):document.getElementById("player1-nickname"),n.textContent=e}function s(e,t){let n=null;n=t?document.getElementById("player2-partial-ip"):document.getElementById("player1-partial-ip"),n.textContent=e}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s}))},,function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(62),s=n(39),o=n(40),a=n(22),r=n(42);const c=new class{constructor(){this.frameCounter=0,this.roomID=null,this.nicknames=["",""],this.partialPublicIPs=["*.*.*.*","*.*.*.*"],this.inputs=[],this.options=[],this.chats=[]}recordRoomID(e){this.roomID=e}recordNicknames(e,t){this.nicknames[0]=e,this.nicknames[1]=t}recordPartialPublicIPs(e,t){this.partialPublicIPs[0]=e,this.partialPublicIPs[1]=t}recordInputs(e,t){const n=(Object(a.b)(e)<<5)+Object(a.b)(t);this.inputs.push(n),this.frameCounter++}recordOptions(e){this.options.push([this.frameCounter,e])}recordChats(e,t){this.chats.push([this.frameCounter,t,e])}saveAsFile(){const e={version:"p2p-online",roomID:this.roomID,nicknames:this.nicknames,partialPublicIPs:this.partialPublicIPs,chats:this.chats,options:this.options,inputs:this.inputs,hash:0},t=Object(o.a)(Object(s.a)(e));e.hash=t;const n={_comment:Object(r.d)(),pack:e},a=new Blob([JSON.stringify(n)],{type:"text/plain;charset=utf-8"}),c=new Date,d=`${c.getFullYear()}${("0"+(c.getMonth()+1)).slice(-2)}${("0"+c.getDate()).slice(-2)}_${("0"+c.getHours()).slice(-2)}${("0"+c.getMinutes()).slice(-2)}_${this.nicknames[0]}_${this.partialPublicIPs[0].replace(".*.*","")}_vs_${this.nicknames[1]}_${this.partialPublicIPs[1].replace(".*.*","")}.txt`.replace(/[/\\?%*:|"<>]/g,"_");Object(i.saveAs)(a,d,{autoBom:!0})}}},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return u}));var i=n(34),s=n(17),o=n(5),a=n(21);const r=8;class c extends i.a{getInput(){this.leftKey.isDown?this.xDirection=-1:this.rightKey.isDown||!o.b.amIPlayer2&&this.downRightKey&&this.downRightKey.isDown?this.xDirection=1:this.xDirection=0,this.upKey.isDown?this.yDirection=-1:this.downKey.isDown||this.downRightKey&&this.downRightKey.isDown?this.yDirection=1:this.yDirection=0;const e=this.powerHitKey.isDown;!this.powerHitKeyIsDownPrevious&&e?this.powerHit=1:this.powerHit=0,this.powerHitKeyIsDownPrevious=e}}const d=new class{constructor(e,t,n,i,s,o,a,r,d,l,u,h){this.keyboard1=new c(e,t,n,i,s,o),this.keyboard2=new c(a,r,d,l,u,h),this._syncCounter=0,this.inputQueue=[]}get syncCounter(){return this._syncCounter}set syncCounter(e){this._syncCounter=Object(a.b)(e,o.a)}subscribe(){this.keyboard1.subscribe(),this.keyboard2.subscribe()}unsubscribe(){this.keyboard1.unsubscribe(),this.keyboard2.unsubscribe()}getInputIfNeededAndSendToPeer(e){if(0===this.inputQueue.length||Object(a.a)(this.syncCounter,e,e+r-1,o.a)){this.keyboard1.getInput(),this.keyboard2.getInput();const e=0!==this.keyboard1.xDirection?this.keyboard1.xDirection:this.keyboard2.xDirection,t=0!==this.keyboard1.yDirection?this.keyboard1.yDirection:this.keyboard2.yDirection,n=0!==this.keyboard1.powerHit?this.keyboard1.powerHit:this.keyboard2.powerHit,i=new u(this.syncCounter,e,t,n);this.inputQueue.push(i),this.syncCounter++}Object(o.h)(this.inputQueue)}}("KeyD","KeyG","KeyR","KeyV","KeyZ","KeyF","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter","ArrowDown");class l{constructor(e){this.xDirection=0,this.yDirection=0,this.powerHit=0,this.inputQueue=e,this.isHistoryBufferFilled=!1}isInputOnQueue(e){if(0===this.inputQueue.length)return!1;if(this.isHistoryBufferFilled)return this.inputQueue.length>r&&(this.inputQueue[r].syncCounter===e||(console.log("Something in OnlineKeyboard is wrong..."),!1));for(let t=0;t<this.inputQueue.length;t++)if(this.inputQueue[t].syncCounter===e)return!0;return!1}getInput(e){if(0===this.inputQueue.length)return void console.log("Something in getInput method is wrong...0");let t=null;if(this.isHistoryBufferFilled){if(!(this.inputQueue.length>r))return void console.log("Something in getInput method is wrong...2");if(t=this.inputQueue[r],t.syncCounter!==e)return void console.log("Something in getInput method is wrong...1");this.inputQueue.shift()}else for(let n=0;n<this.inputQueue.length;n++)if(this.inputQueue[n].syncCounter===e){t=this.inputQueue[n],n===r&&(this.isHistoryBufferFilled=!0,this.inputQueue.shift());break}null!==t?(this.xDirection=t.xDirection,this.yDirection=t.yDirection,this.powerHit=t.powerHit):console.log("Something in getInput method is wrong...3")}}class u extends s.b{constructor(e,t,n,i){super(),this.syncCounter=e,this.xDirection=t,this.yDirection=n,this.powerHit=i}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return o}));var i=n(12);class s{constructor(e,t){this.player1=new a(!1,e),this.player2=new a(!0,t),this.ball=new r(!1)}runEngineForNextFrame(e){return function(e,t,n,i){const s=function(e){e.previousPreviousX=e.previousX,e.previousPreviousY=e.previousY,e.previousX=e.x,e.previousY=e.y;let t=e.fineRotation+e.xVelocity/2;t<0?t+=50:t>50&&(t+=-50);e.fineRotation=t,e.rotation=e.fineRotation/10>>0;const n=e.x+e.xVelocity;(n<20||n>432)&&(e.xVelocity=-e.xVelocity);let i=e.y+e.yVelocity;i<0&&(e.yVelocity=1);Math.abs(e.x-216)<25&&e.y>176&&(e.y<=192?e.yVelocity>0&&(e.yVelocity=-e.yVelocity):e.x<216?e.xVelocity=-Math.abs(e.xVelocity):e.xVelocity=Math.abs(e.xVelocity));if(i=e.y+e.yVelocity,i>252)return e.sound.ballTouchesGround=!0,e.yVelocity=-e.yVelocity,e.punchEffectX=e.x,e.y=252,e.punchEffectRadius=20,e.punchEffectY=272,!0;return e.y=i,e.x=e.x+e.xVelocity,e.yVelocity+=1,!1}(n);let o,a;for(let s=0;s<2;s++)0===s?(o=e,a=t):(o=t,a=e),u(n),d(o,i[s],a,n);for(let s=0;s<2;s++){o=0===s?e:t;!0===c(n,o.x,o.y)?!1===o.isCollisionWithBallHappened&&(l(n,o.x,i[s],o.state),o.isCollisionWithBallHappened=!0):o.isCollisionWithBallHappened=!1}return s}(this.player1,this.player2,this.ball,e)}}class o{constructor(){this.xDirection=0,this.yDirection=0,this.powerHit=0}}class a{constructor(e,t){this.isPlayer2=e,this.isComputer=t,this.initializeForNewRound(),this.divingDirection=0,this.lyingDownDurationLeft=-1,this.isWinner=!1,this.gameEnded=!1,this.computerWhereToStandBy=0,this.sound={pipikachu:!1,pika:!1,chu:!1}}initializeForNewRound(){this.x=36,this.isPlayer2&&(this.x=396),this.y=244,this.yVelocity=0,this.isCollisionWithBallHappened=!1,this.state=0,this.frameNumber=0,this.normalStatusArmSwingDirection=1,this.delayBeforeNextFrame=0,this.computerBoldness=Object(i.a)()%5}}class r{constructor(e){this.initializeForNewRound(e),this.expectedLandingPointX=0,this.rotation=0,this.fineRotation=0,this.punchEffectX=0,this.punchEffectY=0,this.previousX=0,this.previousPreviousX=0,this.previousY=0,this.previousPreviousY=0,this.sound={powerHit:!1,ballTouchesGround:!1}}initializeForNewRound(e){this.x=56,!0===e&&(this.x=376),this.y=0,this.xVelocity=0,this.yVelocity=1,this.punchEffectRadius=0,this.isPowerHit=!1}}function c(e,t,n){let i=e.x-t;return Math.abs(i)<=32&&(i=e.y-n,Math.abs(i)<=32)}function d(e,t,n,s){if(!0===e.isComputer&&function(e,t,n,s){s.xDirection=0,s.yDirection=0,s.powerHit=0;let o=t.expectedLandingPointX;if(Math.abs(t.x-e.x)>100&&Math.abs(t.xVelocity)<e.computerBoldness+5){const n=216*Number(e.isPlayer2);(t.expectedLandingPointX<=n||t.expectedLandingPointX>=432*Number(e.isPlayer2)+216)&&0===e.computerWhereToStandBy&&(o=n+108)}Math.abs(o-e.x)>e.computerBoldness+8?e.x<o?s.xDirection=1:s.xDirection=-1:Object(i.a)()%20==0&&(e.computerWhereToStandBy=Object(i.a)()%2);if(0===e.state){Math.abs(t.xVelocity)<e.computerBoldness+3&&Math.abs(t.x-e.x)<32&&t.y>-36&&t.y<10*e.computerBoldness+84&&t.yVelocity>0&&(s.yDirection=-1);const n=216*Number(e.isPlayer2),i=216*(Number(e.isPlayer2)+1);t.expectedLandingPointX>n&&t.expectedLandingPointX<i&&Math.abs(t.x-e.x)>5*e.computerBoldness+64&&t.x>n&&t.x<i&&t.y>174&&(s.powerHit=1,e.x<t.x?s.xDirection=1:s.xDirection=-1)}else if((1===e.state||2===e.state)&&(Math.abs(t.x-e.x)>8&&(e.x<t.x?s.xDirection=1:s.xDirection=-1),Math.abs(t.x-e.x)<48&&Math.abs(t.y-e.y)<48)){!0===function(e,t,n,s){if(Object(i.a)()%2==0)for(let i=1;i>-1;i--)for(let o=-1;o<2;o++){const a=h(i,o,t);if((a<=216*Number(e.isPlayer2)||a>=432*Number(e.isPlayer2)+216)&&Math.abs(a-n.x)>64)return s.xDirection=i,s.yDirection=o,!0}else for(let i=1;i>-1;i--)for(let o=1;o>-2;o--){const a=h(i,o,t);if((a<=216*Number(e.isPlayer2)||a>=432*Number(e.isPlayer2)+216)&&Math.abs(a-n.x)>64)return s.xDirection=i,s.yDirection=o,!0}return!1}(e,t,n,s)&&(s.powerHit=1,Math.abs(n.x-e.x)<80&&-1!==s.yDirection&&(s.yDirection=-1))}}(e,s,n,t),4===e.state)return e.lyingDownDurationLeft+=-1,void(e.lyingDownDurationLeft<-1&&(e.state=0));let o=0;e.state<5&&(o=e.state<3?6*t.xDirection:8*e.divingDirection);const a=e.x+o;e.x=a,!1===e.isPlayer2?a<32?e.x=32:a>184&&(e.x=184):a<248?e.x=248:a>400&&(e.x=400),e.state<3&&-1===t.yDirection&&244===e.y&&(e.yVelocity=-16,e.state=1,e.frameNumber=0,e.sound.chu=!0);const r=e.y+e.yVelocity;if(e.y=r,r<244?e.yVelocity+=1:r>244&&(e.yVelocity=0,e.y=244,e.frameNumber=0,3===e.state?(e.state=4,e.frameNumber=0,e.lyingDownDurationLeft=3):e.state=0),1===t.powerHit&&(1===e.state?(e.delayBeforeNextFrame=5,e.frameNumber=0,e.state=2,e.sound.pika=!0):0===e.state&&0!==t.xDirection&&(e.state=3,e.frameNumber=0,e.divingDirection=t.xDirection,e.yVelocity=-5,e.sound.chu=!0)),1===e.state)e.frameNumber=(e.frameNumber+1)%3;else if(2===e.state)e.delayBeforeNextFrame<1?(e.frameNumber+=1,e.frameNumber>4&&(e.frameNumber=0,e.state=1)):e.delayBeforeNextFrame-=1;else if(0===e.state&&(e.delayBeforeNextFrame+=1,e.delayBeforeNextFrame>3)){e.delayBeforeNextFrame=0;const t=e.frameNumber+e.normalStatusArmSwingDirection;(t<0||t>4)&&(e.normalStatusArmSwingDirection=-e.normalStatusArmSwingDirection),e.frameNumber=e.frameNumber+e.normalStatusArmSwingDirection}!0===e.gameEnded&&(0===e.state&&(!0===e.isWinner?(e.state=5,e.sound.pipikachu=!0):e.state=6,e.delayBeforeNextFrame=0,e.frameNumber=0),function(e){!0===e.gameEnded&&e.frameNumber<4&&(e.delayBeforeNextFrame+=1,e.delayBeforeNextFrame>4&&(e.delayBeforeNextFrame=0,e.frameNumber+=1))}(e))}function l(e,t,n,s){e.x<t?e.xVelocity=-Math.floor(Math.abs(e.x-t)/3):e.x>t&&(e.xVelocity=Math.floor(Math.abs(e.x-t)/3)),0===e.xVelocity&&(e.xVelocity=Object(i.a)()%3-1);const o=Math.abs(e.yVelocity);e.yVelocity=-o,o<15&&(e.yVelocity=-15),2===s?(e.x<216?e.xVelocity=10*(Math.abs(n.xDirection)+1):e.xVelocity=10*-(Math.abs(n.xDirection)+1),e.punchEffectX=e.x,e.punchEffectY=e.y,e.yVelocity=Math.abs(e.yVelocity)*n.yDirection*2,e.punchEffectRadius=20,e.sound.powerHit=!0,e.isPowerHit=!0):e.isPowerHit=!1,u(e)}function u(e){const t={x:e.x,y:e.y,xVelocity:e.xVelocity,yVelocity:e.yVelocity};let n=0;for(;;){n++;const e=t.xVelocity+t.x;if((e<20||e>432)&&(t.xVelocity=-t.xVelocity),t.y+t.yVelocity<0&&(t.yVelocity=1),Math.abs(t.x-216)<25&&t.y>176&&(t.y<192?t.yVelocity>0&&(t.yVelocity=-t.yVelocity):t.x<216?t.xVelocity=-Math.abs(t.xVelocity):t.xVelocity=Math.abs(t.xVelocity)),t.y=t.y+t.yVelocity,t.y>252||n>=1e3)break;t.x=t.x+t.xVelocity,t.yVelocity+=1}e.expectedLandingPointX=t.x}function h(e,t,n){const i={x:n.x,y:n.y,xVelocity:n.xVelocity,yVelocity:n.yVelocity};i.x<216?i.xVelocity=10*(Math.abs(e)+1):i.xVelocity=10*-(Math.abs(e)+1),i.yVelocity=Math.abs(i.yVelocity)*t*2;let s=0;for(;;){s++;const e=i.x+i.xVelocity;if((e<20||e>432)&&(i.xVelocity=-i.xVelocity),i.y+i.yVelocity<0&&(i.yVelocity=1),Math.abs(i.x-216)<25&&i.y>176&&i.yVelocity>0&&(i.yVelocity=-i.yVelocity),i.y=i.y+i.yVelocity,i.y>252||s>=1e3)return i.x;i.x=i.x+i.xVelocity,i.yVelocity+=1}}},,function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"e",(function(){return m})),n.d(t,"c",(function(){return p})),n.d(t,"d",(function(){return y})),n.d(t,"b",(function(){return g}));var i=n(5),s=n(7);let o=null,a=null;const r="initial",c="roomCreated",d="quickMatchSuccess",l="withFriendSuccess",u="cancel",h={createRoom:"createRoom",keepWait:"keepWait",connectToPeer:"connectToPeer",connectToPeerAfterAWhile:"connectToPeerAfterAWhile",waitPeerConnection:"waitPeerConnection",abandoned:"abandoned"};function m(e){o=e,a=0,f("",w(r,o)).then(b)}function p(){console.log("Send quick match success message to server"),f("",w(d,o))}function y(){console.log("Send with friend success message to server"),f("",w(l,o))}function g(){console.log("Send cancel quick match message to server"),f("",w(u,o))}async function f(e="",t={}){try{return(await fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(t)})).json()}catch(e){Object(s.w)(e),Object(s.p)()}}const b=e=>{if(null!==e.numOfSuccess){const t=e.numOfSuccess;Object(s.u)(t.withinLast24hours,t.withinLast1hour,t.withinLast10minutes)}switch(e.message){case h.createRoom:console.log("Create room!"),Object(i.e)(o),window.setTimeout(()=>{f("",w(c,o)).then(b)},1e3);break;case h.keepWait:console.log("Keep wait!"),window.setTimeout(()=>{f("",w(c,o)).then(b)},1e3);break;case h.waitPeerConnection:console.log("Wait peer connection!");break;case h.connectToPeerAfterAWhile:console.log("Connect To Peer after 5 seconds..."),window.setTimeout(()=>{console.log("Connect To Peer!"),Object(s.x)(h.connectToPeer),Object(i.f)(e.roomId)},5e3);break;case h.connectToPeer:console.log("Connect To Peer!"),Object(i.f)(e.roomId);break;case h.abandoned:console.log("room id abandoned.. please retry quick match.");break;case h.cancelAccepted:console.log("quick match cancel accepted")}a++,Object(s.n)(a),Object(s.x)(e.message)};function w(e,t){return{message:e,roomId:t}}},,function(e,t,n){"use strict";function i(e,t){return(e%t+t)%t}function s(e,t,n,s){const o=i(e,s);if(i(t,s)<=i(n,s)){if(i(t,s)<=o&&o<=i(n,s))return!0}else if(i(t,s)<=o||o<=i(n,s))return!0;return!1}n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}))},function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return o}));var i=n(17);function s(e){let t=0;switch(e.xDirection){case 1:t+=1;break;case-1:t+=3}switch(e.yDirection){case 1:t+=4;break;case-1:t+=12}switch(e.powerHit){case 1:t+=16}return t}function o(e){const t=new i.b;switch(e%4){case 0:t.xDirection=0;break;case 1:t.xDirection=1;break;case 3:t.xDirection=-1}switch((e>>>2)%4){case 0:t.yDirection=0;break;case 1:t.yDirection=1;break;case 3:t.yDirection=-1}return t.powerHit=e>>>4,t}},,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a}));var i=n(12);class s{constructor(){this.topLeftPointX=Object(i.a)()%500-68,this.topLeftPointY=Object(i.a)()%152,this.topLeftPointXVelocity=1+Object(i.a)()%2,this.sizeDiffTurnNumber=Object(i.a)()%11}get sizeDiff(){return 5-Math.abs(this.sizeDiffTurnNumber-5)}get spriteTopLeftPointX(){return this.topLeftPointX-this.sizeDiff}get spriteTopLeftPointY(){return this.topLeftPointY-this.sizeDiff}get spriteWidth(){return 48+2*this.sizeDiff}get spriteHeight(){return 24+2*this.sizeDiff}}class o{constructor(){this.verticalCoord=0,this.verticalCoordVelocity=2,this.yCoords=[];for(let e=0;e<27;e++)this.yCoords.push(314)}}function a(e,t){for(let t=0;t<10;t++)e[t].topLeftPointX+=e[t].topLeftPointXVelocity,e[t].topLeftPointX>432&&(e[t].topLeftPointX=-68,e[t].topLeftPointY=Object(i.a)()%152,e[t].topLeftPointXVelocity=1+Object(i.a)()%2),e[t].sizeDiffTurnNumber=(e[t].sizeDiffTurnNumber+1)%11;t.verticalCoord+=t.verticalCoordVelocity,t.verticalCoord>32?(t.verticalCoord=32,t.verticalCoordVelocity=-1):t.verticalCoord<0&&t.verticalCoordVelocity<0&&(t.verticalCoordVelocity=2,t.verticalCoord=-Object(i.a)()%40);for(let e=0;e<27;e++)t.yCoords[e]=314-t.verticalCoord+Object(i.a)()%3}},function(e,t,n){"use strict";function i(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:n[t[e]]=t[e+1]}return n}function s(e){const t=i(e);if("srflx"===t.type)return t.ip;if("host"===t.type&&!t.ip.endsWith(".local")){if(!RegExp("(^127.)|(^10.)|(^172.1[6-9].)|(^172.2[0-9].)|(^172.3[0-1].)|(^192.168.)").test(t.ip))return t.ip}return null}function o(e){const t=e.indexOf(".",e.indexOf(".")+1);return-1===t?e.slice(0,7):e.slice(0,t)+".*.*"}n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return o}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}]}},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(17);class s extends i.b{constructor(e,t,n,i,s,a=null){super(),this.powerHitKeyIsDownPrevious=!1,this.leftKey=new o(e),this.rightKey=new o(t),this.upKey=new o(n),this.downKey=new o(i),this.powerHitKey=new o(s),this.downRightKey=new o(a)}getInput(){this.leftKey.isDown?this.xDirection=-1:this.rightKey.isDown||this.downRightKey&&this.downRightKey.isDown?this.xDirection=1:this.xDirection=0,this.upKey.isDown?this.yDirection=-1:this.downKey.isDown||this.downRightKey&&this.downRightKey.isDown?this.yDirection=1:this.yDirection=0;const e=this.powerHitKey.isDown;!this.powerHitKeyIsDownPrevious&&e?this.powerHit=1:this.powerHit=0,this.powerHitKeyIsDownPrevious=e}subscribe(){this.leftKey.subscribe(),this.rightKey.subscribe(),this.upKey.subscribe(),this.downKey.subscribe(),this.powerHitKey.subscribe(),this.downRightKey.subscribe()}unsubscribe(){this.leftKey.unsubscribe(),this.rightKey.unsubscribe(),this.upKey.unsubscribe(),this.downKey.unsubscribe(),this.powerHitKey.unsubscribe(),this.downRightKey.unsubscribe()}}class o{constructor(e){this.value=e,this.isDown=!1,this.isUp=!0,this.downListener=this.downHandler.bind(this),this.upListner=this.upHandler.bind(this),this.subscribe()}downHandler(e){e.code===this.value&&(this.isDown=!0,this.isUp=!1,e.preventDefault())}upHandler(e){e.code===this.value&&(this.isDown=!1,this.isUp=!0,e.preventDefault())}subscribe(){window.addEventListener("keydown",this.downListener),window.addEventListener("keyup",this.upListner)}unsubscribe(){window.removeEventListener("keydown",this.downListener),window.removeEventListener("keyup",this.upListner),this.isDown=!1,this.isUp=!0}}},,,function(e,t,n){},,function(e,t,n){"use strict";function i(e){return Array.isArray(e)?JSON.stringify(e.map(e=>i(e))):"object"==typeof e&&null!==e?Object.keys(e).sort().map(t=>`${t}:${i(e[t])}`).join("|"):e}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function i(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function i(){return new URLSearchParams(window.location.search).get("partyId")}function s(){return!i()}function o(){const e=i();if(e){document.getElementById("join-room-id-input").value=e;return void document.getElementById("join-btn").click()}document.getElementById("with-your-friend-btn").click();document.getElementById("create-btn").click()}n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return o}))},function(e,t,n){"use strict";n.d(t,"j",(function(){return O})),n.d(t,"a",(function(){return D})),n.d(t,"b",(function(){return A})),n.d(t,"g",(function(){return M})),n.d(t,"e",(function(){return T})),n.d(t,"h",(function(){return j})),n.d(t,"d",(function(){return N})),n.d(t,"i",(function(){return R})),n.d(t,"f",(function(){return V})),n.d(t,"l",(function(){return F})),n.d(t,"m",(function(){return H})),n.d(t,"k",(function(){return _})),n.d(t,"c",(function(){return W}));var i=n(6),s=(n(24),n(9)),o=n(25),a=n.n(o),r=n(43),c=n(12),d=n(11),l=n(13),u=n(29),h=n(17),m=n(22);class p extends r.a{constructor(e,t,n,i,s,o,a,r){super(e,t),this.noInputFrameTotal.menu=1/0,this.roomId=n,this.nicknames=i,this.partialPublicIPs=s,this.inputs=o,this.options=a,this.chats=r,this.player1Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:()=>{}},this.player2Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:()=>{}},this.keyboardArray=[this.player1Keyboard,this.player2Keyboard],this.willMoveScrubber=!0,this.willDisplayChat=!0;const c={play:()=>{},stop:()=>{}};this.fakeAudio={sounds:{bgm:{fake:!0,playing:!1,play:function(){this.playing=!0},stop:function(){this.playing=!1}},pipikachu:c,pika:c,chu:c,pi:c,pikachu:c,powerHit:c,ballTouchesGround:c}},this.initilizeForReplay()}initilizeForReplay(){for(const e in this.audio.sounds)this.audio.sounds[e].stop();this.timeCurrent=0,this.timeBGM=0,this.replayFrameCounter=0,this.chatCounter=0,this.optionsCounter=0;const e=a.a.alea(this.roomId.slice(10));Object(c.b)(e);const t=a.a.alea(this.roomId.slice(10,15)),n=a.a.alea(this.roomId.slice(15));Object(d.f)(t,n),this.view.game.cloudArray=[];for(let e=0;e<10;e++)this.view.game.cloudArray.push(new u.a);this.view.game.wave=new u.b,this.view.intro.visible=!1,this.view.menu.visible=!1,this.view.game.visible=!1,this.view.fadeInOut.visible=!1,this.physics=new h.a(!0,!0),this.normalFPS=25,this.slowMotionFPS=5,this.SLOW_MOTION_FRAMES_NUM=6,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.selectedWithWho=0,this.scores=[0,0],this.winningScore=15,this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.frameCounter=0,this.noInputFrameCounter=0,this.paused=!1,this.isStereoSound=!0,this._isPracticeMode=!1,this.isRoomCreatorPlayer2=!1,this.state=this.intro}intro(){0===this.frameCounter&&(this.selectedWithWho=0,this.nicknames&&(Object(l.a)(this.nicknames[0],this.isRoomCreatorPlayer2),Object(l.a)(this.nicknames[1],!this.isRoomCreatorPlayer2)),this.partialPublicIPs&&(Object(l.b)(this.partialPublicIPs[0],this.isRoomCreatorPlayer2),Object(l.b)(this.partialPublicIPs[1],!this.isRoomCreatorPlayer2))),super.intro()}menu(){const e=this.selectedWithWho;super.menu(),this.selectedWithWho!==e&&(this.isRoomCreatorPlayer2=!this.isRoomCreatorPlayer2,this.nicknames&&(Object(l.a)(this.nicknames[0],this.isRoomCreatorPlayer2),Object(l.a)(this.nicknames[1],!this.isRoomCreatorPlayer2)),this.partialPublicIPs&&(Object(l.b)(this.partialPublicIPs[0],this.isRoomCreatorPlayer2),Object(l.b)(this.partialPublicIPs[1],!this.isRoomCreatorPlayer2)))}gameLoopSilent(){const e=this.audio;this.willDisplayChat=!1,this.willMoveScrubber=!1,this.audio=this.fakeAudio,this.gameLoop(),this.willMoveScrubber=!0,this.willDisplayChat=!0,this.audio=e}gameLoop(){if(this.replayFrameCounter>=this.inputs.length)return void M();this.willMoveScrubber&&V(this.replayFrameCounter);const e=this.inputs[this.replayFrameCounter],t=Object(m.a)(e>>>5),n=Object(m.a)(e%32);this.player1Keyboard.xDirection=t.xDirection,this.player1Keyboard.yDirection=t.yDirection,this.player1Keyboard.powerHit=t.powerHit,this.player2Keyboard.xDirection=n.xDirection,this.player2Keyboard.yDirection=n.yDirection,this.player2Keyboard.powerHit=n.powerHit,_(t,n);let i=this.options[this.optionsCounter];for(;i&&i[0]===this.replayFrameCounter;){if(i[1].speed){switch(i[1].speed){case"slow":this.normalFPS=20;break;case"medium":this.normalFPS=25;break;case"fast":this.normalFPS=30}b(this.normalFPS)}if(i[1].winningScore)switch(i[1].winningScore){case 5:this.winningScore=5;break;case 10:this.winningScore=10;break;case 15:this.winningScore=15}this.optionsCounter++,i=this.options[this.optionsCounter]}this.timeCurrent+=1/this.normalFPS,this.audio.sounds.bgm.fake&&(this.audio.sounds.bgm.playing?this.timeBGM=(this.timeBGM+1/this.normalFPS)%83:this.timeBGM=0);let s=this.chats[this.chatCounter];for(;s&&s[0]===this.replayFrameCounter;)this.willDisplayChat&&Object(d.a)(s[2],s[1]),this.chatCounter++,s=this.chats[this.chatCounter];this.replayFrameCounter++,this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,super.gameLoop()}}n(37);var y=n(39),g=n(40);const f=new class{constructor(){this.ticker=new i.Ticker,this.ticker.minFPS=1,this.renderer=i.autoDetectRenderer({width:432,height:304,antialias:!1,backgroundColor:0,transparent:!1}),this.stage=new i.Container,this.loader=new i.Loader,this.pikaVolley=null,this.playBackSpeedTimes=1,this.playBackSpeedFPS=null}readFile(e){const t=i.settings;t.RESOLUTION=window.devicePixelRatio,t.SCALE_MODE=i.SCALE_MODES.NEAREST,t.ROUND_PIXELS=!0;const n=s.a.TEXTURES;n.WITH_COMPUTER=n.WITH_FRIEND,document.querySelector("#game-canvas-container").appendChild(this.renderer.view),this.renderer.render(this.stage),this.ticker.add(()=>{this.renderer.render(this.stage),F(this.pikaVolley.timeCurrent),this.pikaVolley.gameLoop()}),this.loader.add(s.a.SPRITE_SHEET);for(const e in s.a.SOUNDS)this.loader.add(s.a.SOUNDS[e]);!function(e){const t=document.getElementById("loading-box"),n=document.getElementById("progress-bar");e.onProgress.add(()=>{n.style.width=e.progress+"%"}),e.onComplete.add(()=>{t.classList.contains("hidden")||t.classList.add("hidden")})}(this.loader);const o=new FileReader;o.onload=e=>{let t,n;try{t=JSON.parse(e.target.result),n=t.pack;const i=n.hash;if(n.hash=0,i!==Object(g.a)(Object(y.a)(n)))throw"Error: The file content is not matching the hash code"}catch(e){return console.log(e),void j()}H(function(e){const t=[];let n=0,i=e.options[n];for(;i;){if(i[1].speed){let e=null;switch(i[1].speed){case"slow":e=20;break;case"medium":e=25;break;case"fast":e=30}const n=i[0];t.push([n,e])}n++,i=e.options[n]}let s=0,o=0,a=25;for(let e=0;e<t.length;e++){const n=t[e][0],i=t[e][1];s+=(n-o)/a,o=n,a=i}return s+=(e.inputs.length-o)/a,s}(n)),this.loader.load(()=>{this.pikaVolley=new p(this.stage,this.loader.resources,n.roomID,n.nicknames,n.partialPublicIPs,n.inputs,n.options,n.chats),Object(d.g)(this.pikaVolley),R(n.inputs.length),this.seekFrame(0),this.ticker.start(),A(),W()})};try{o.readAsText(e)}catch(e){return console.log(e),void j()}}seekFrame(e){if(Object(d.e)(),T(),this.ticker.stop(),this.pikaVolley.initilizeForReplay(),e>0){for(let t=0;t<e;t++)this.pikaVolley.gameLoopSilent();this.renderer.render(this.stage)}F(this.pikaVolley.timeCurrent)}seekRelativeTime(e){const t=Math.max(0,this.pikaVolley.replayFrameCounter+e*this.pikaVolley.normalFPS);this.seekFrame(t)}adjustPlaybackSpeedTimes(e){this.playBackSpeedFPS=null,this.playBackSpeedTimes=e,this.ticker.maxFPS=this.pikaVolley.normalFPS*this.playBackSpeedTimes,D()}adjustPlaybackSpeedFPS(e){this.playBackSpeedTimes=null,this.playBackSpeedFPS=e,this.ticker.maxFPS=this.playBackSpeedFPS,D()}stopBGM(){this.pikaVolley.audio.sounds.bgm.center.stop()}pauseBGM(){this.pikaVolley.audio.sounds.bgm.center.pause()}resumeBGM(){this.pikaVolley.audio.sounds.bgm.center.resume()}playBGMProperlyAfterScrubbbing(){this.pikaVolley.fakeAudio.sounds.bgm.playing&&this.pikaVolley.audio.sounds.bgm.center.play({start:this.pikaVolley.timeBGM})}};function b(e){f.playBackSpeedFPS?(f.ticker.maxFPS=f.playBackSpeedFPS,D()):f.playBackSpeedTimes&&(f.ticker.maxFPS=e*f.playBackSpeedTimes,D())}let w=!1;const v=document.getElementById("scrubber-range-input"),k=document.getElementById("play-pause-btn"),E=document.getElementById("seek-backward-1"),I=document.getElementById("seek-forward-1"),C=document.getElementById("seek-backward-3"),x=document.getElementById("seek-forward-3"),L=document.getElementById("speed-btn-5-fps"),S=document.getElementById("speed-btn-half-times"),B=document.getElementById("speed-btn-1-times"),P=document.getElementById("speed-btn-2-times");function O(){v.disabled=!0,k.disabled=!0,E.disabled=!0,I.disabled=!0,C.disabled=!0,x.disabled=!0,L.disabled=!0,S.disabled=!0,B.disabled=!0,P.disabled=!0;document.getElementById("file-input").addEventListener("change",n=>{document.getElementById("loading-box").classList.remove("hidden"),e.classList.add("hidden"),t(n.target.files)});const e=document.getElementById("dropbox");function t(e){f.readFile(e[0])}function n(e){i(),e.currentTarget.classList.contains("selected")||e.currentTarget.classList.add("selected")}function i(){for(const e of[L,S,B,P])e.classList.remove("selected")}e.addEventListener("dragenter",(function(e){e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("drop",(function(n){n.stopPropagation(),n.preventDefault();const i=n.dataTransfer.files;document.getElementById("loading-box").classList.remove("hidden"),e.classList.add("hidden"),t(i)}),!1),v.addEventListener("touchstart",()=>{f.ticker.started&&(f.ticker.stop(),f.stopBGM())}),v.addEventListener("mousedown",()=>{f.ticker.started&&(f.ticker.stop(),f.stopBGM())}),v.addEventListener("touchend",()=>{w||f.ticker.started||(f.ticker.start(),f.playBGMProperlyAfterScrubbbing())}),v.addEventListener("mouseup",()=>{w||f.ticker.started||(f.ticker.start(),f.playBGMProperlyAfterScrubbbing())}),v.addEventListener("input",e=>{f.seekFrame(Number(e.currentTarget.value))}),k.disabled=!0,k.addEventListener("click",()=>{f.ticker.started?(f.ticker.stop(),f.pauseBGM(),w=!0,A()):(f.ticker.start(),f.resumeBGM(),w=!1,A())}),E.addEventListener("click",()=>{f.seekRelativeTime(-1),w||f.ticker.started||(f.ticker.start(),f.playBGMProperlyAfterScrubbbing())}),I.addEventListener("click",()=>{f.seekRelativeTime(1),w||f.ticker.started||(f.ticker.start(),f.playBGMProperlyAfterScrubbbing())}),C.addEventListener("click",()=>{f.seekRelativeTime(-3),w||f.ticker.started||(f.ticker.start(),f.playBGMProperlyAfterScrubbbing())}),x.addEventListener("click",()=>{f.seekRelativeTime(3),w||f.ticker.started||(f.ticker.start(),f.playBGMProperlyAfterScrubbbing())}),L.addEventListener("click",e=>{n(e),f.adjustPlaybackSpeedFPS(5)}),S.addEventListener("click",e=>{n(e),f.adjustPlaybackSpeedTimes(.5)}),B.addEventListener("click",e=>{n(e),f.adjustPlaybackSpeedTimes(1)}),P.addEventListener("click",e=>{n(e),f.adjustPlaybackSpeedTimes(2)});document.getElementById("fps-input").addEventListener("change",e=>{let t=e.target.value;t<0?t=0:t>60&&(t=60),f.adjustPlaybackSpeedFPS(t),i()});document.getElementById("notice-end-of-replay-ok-btn").addEventListener("click",()=>{location.reload()});document.getElementById("notice-file-open-error-ok-btn").addEventListener("click",()=>{location.reload()});const s=document.getElementById("keyboard-container"),o=document.getElementById("show-keyboard-checkbox");o.addEventListener("change",()=>{o.checked?s.classList.remove("hidden"):s.classList.add("hidden")});const a=document.getElementById("show-chat-checkbox");a.addEventListener("change",()=>{a.checked?Object(d.d)(!0):(Object(d.d)(!1),Object(d.e)())});const r=document.getElementById("show-nicknames-checkbox"),c=document.getElementById("player1-nickname"),l=document.getElementById("player2-nickname");r.addEventListener("change",()=>{r.checked?(c.classList.remove("hidden"),l.classList.remove("hidden")):(c.classList.contains("hidden")||c.classList.add("hidden"),l.classList.contains("hidden")||l.classList.add("hidden"))});const u=document.getElementById("show-ip-addresses-checkbox"),h=document.getElementById("player1-partial-ip"),m=document.getElementById("player2-partial-ip");u.addEventListener("change",()=>{u.checked?(h.classList.remove("hidden"),m.classList.remove("hidden")):(h.classList.contains("hidden")||h.classList.add("hidden"),m.classList.contains("hidden")||m.classList.add("hidden"))})}function D(){document.getElementById("fps-input").value=f.ticker.maxFPS}function A(){const e=document.getElementById("play-pause-btn");f.ticker.started?e.textContent=document.getElementById("pause-mark").textContent:e.textContent=document.getElementById("play-mark").textContent}function M(){document.getElementById("notice-end-of-replay").classList.remove("hidden")}function T(){const e=document.getElementById("notice-end-of-replay");e.classList.contains("hidden")||e.classList.add("hidden")}function j(){document.getElementById("notice-file-open-error").classList.remove("hidden")}function N(){return document.getElementById("replay-viewer-at").textContent}function R(e){v.max=e}function V(e){v.value=e}function F(e){document.getElementById("time-current").textContent=K(e)}function H(e){document.getElementById("time-duration").textContent=K(e)}function _(e,t){const n=document.getElementById("z-key"),i=document.getElementById("r-key"),s=document.getElementById("v-key"),o=document.getElementById("d-key"),a=document.getElementById("g-key"),r=document.getElementById("enter-key"),c=document.getElementById("up-key"),d=document.getElementById("down-key"),l=document.getElementById("left-key"),u=document.getElementById("right-key");function h(e){e.classList.contains("pressed")||e.classList.add("pressed")}function m(e){e.classList.remove("pressed")}switch(e.xDirection){case 0:m(o),m(a);break;case-1:h(o),m(a);break;case 1:m(o),h(a)}switch(e.yDirection){case 0:m(i),m(s);break;case-1:h(i),m(s);break;case 1:m(i),h(s)}switch(e.powerHit){case 0:m(n);break;case 1:h(n)}switch(t.xDirection){case 0:m(l),m(u);break;case-1:h(l),m(u);break;case 1:m(l),h(u)}switch(t.yDirection){case 0:m(c),m(d);break;case-1:h(c),m(d);break;case 1:m(c),h(d)}switch(t.powerHit){case 0:m(r);break;case 1:h(r)}}function W(){v.disabled=!1,k.disabled=!1,E.disabled=!1,I.disabled=!1,C.disabled=!1,x.disabled=!1,L.disabled=!1,S.disabled=!1,B.disabled=!1,P.disabled=!1}function K(e){const t=Math.floor(e%60),n=Math.floor(e/60)%60,i=Math.floor(Math.floor(e/60)/60);return i>0?`${String(i)}:${("0"+n).slice(-2)}:${("0"+t).slice(-2)}`:`${String(n)}:${("0"+t).slice(-2)}`}},function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var i=n(17),s=n(6),o=n(29),a=n(9);const r=a.a.TEXTURES;class c{constructor(e){const t=e[a.a.SPRITE_SHEET].textures;this.mark=h(t,r.MARK,.5,.5),this.mark.x=216,this.mark.y=152,this.container=new s.Container,this.container.addChild(this.mark)}get visible(){return this.container.visible}set visible(e){this.container.visible=e}drawMark(e){const t=this.mark;0!==e?e<100?t.alpha=Math.min(1,t.alpha+.04):e>=100&&(t.alpha=Math.max(0,t.alpha-.04)):t.alpha=0}}class d{constructor(e){const t=e[a.a.SPRITE_SHEET].textures;this.messages={pokemon:h(t,r.POKEMON,0,0),pikachuVolleyball:h(t,r.PIKACHU_VOLLEYBALL,0,0),withWho:[h(t,r.WITH_COMPUTER,0,0),h(t,r.WITH_FRIEND,0,0)],sachisoft:h(t,r.SACHISOFT,0,0),fight:h(t,r.FIGHT,0,0)},this.sittingPikachuTilesContainer=function(e){const t=new s.Container,n=e[r.SITTING_PIKACHU],i=n.width,o=n.height;let a;for(let e=0;e<Math.floor(304/o)+2;e++)for(let r=0;r<Math.floor(432/i)+2;r++)a=new s.Sprite(n),p(t,a,i*r,o*e);return t}(t),this.messages.sachisoft.x=216-this.messages.sachisoft.texture.width/2,this.messages.sachisoft.y=264,this.messages.pikachuVolleyball.x=140,this.messages.pikachuVolleyball.y=80,this.messages.pokemon.x=170,this.messages.pokemon.y=40,this.container=new s.Container,this.container.addChild(this.sittingPikachuTilesContainer),this.container.addChild(this.messages.pokemon),this.container.addChild(this.messages.pikachuVolleyball),this.container.addChild(this.messages.withWho[0]),this.container.addChild(this.messages.withWho[1]),this.container.addChild(this.messages.sachisoft),this.container.addChild(this.messages.fight),this.initializeVisibles(),this.sittingPikachuTilesDisplacement=0,this.selectedWithWho=-1,this.selectedWithWhoMessageSizeIncrement=2}get visible(){return this.container.visible}set visible(e){this.container.visible=e,!1===e&&this.initializeVisibles()}initializeVisibles(){for(const e in this.messages)this.messages[e].visible=!1}drawFightMessage(e){const t=[20,22,25,27,30,27,25,22,20],n=this.messages.fight,i=n.texture.width,s=n.texture.height;if(0===e&&(n.visible=!0),e<30){const t=Math.floor(Math.floor(e*i/30)/2),o=Math.floor(Math.floor(e*s/30)/2);n.width=2*t,n.height=2*o,n.x=100-t,n.y=70-o}else{const o=(e+1)%9,a=Math.floor(Math.floor(t[o]*i/30)/2),r=Math.floor(Math.floor(t[o]*s/30)/2);n.width=2*a,n.height=2*r,n.y=70-r,n.x=100-a}}drawSachisoft(e){0===e&&(this.messages.sachisoft.visible=!0,this.messages.sachisoft.alpha=0),this.messages.sachisoft.alpha=Math.min(1,this.messages.sachisoft.alpha+.04),e>70&&(this.messages.sachisoft.alpha=1)}drawSittingPikachuTiles(e){0===e&&(this.sittingPikachuTilesContainer.visible=!0,this.sittingPikachuTilesContainer.alpha=0);const t=this.sittingPikachuTilesContainer.getChildAt(0).texture.height;this.sittingPikachuTilesDisplacement=(this.sittingPikachuTilesDisplacement+2)%t,this.sittingPikachuTilesContainer.x=-this.sittingPikachuTilesDisplacement,this.sittingPikachuTilesContainer.y=-this.sittingPikachuTilesDisplacement,e>30&&(this.sittingPikachuTilesContainer.alpha=Math.min(1,this.sittingPikachuTilesContainer.alpha+.04)),e>70&&(this.sittingPikachuTilesContainer.alpha=1)}drawPikachuVolleyballMessage(e){if(0!==e)if(e>30&&(this.messages.pikachuVolleyball.visible=!0),e>30&&e<=44){const t=195-15*(e-30);this.messages.pikachuVolleyball.x=140+t}else e>44&&e<=55?(this.messages.pikachuVolleyball.x=140,this.messages.pikachuVolleyball.width=200-15*(e-44)):e>55&&e<=71?(this.messages.pikachuVolleyball.x=140,this.messages.pikachuVolleyball.width=40+15*(e-55)):e>71&&(this.messages.pikachuVolleyball.x=140,this.messages.pikachuVolleyball.width=this.messages.pikachuVolleyball.texture.width);else this.messages.pikachuVolleyball.visible=!1}drawPokemonMessage(e){0!==e?e>71&&(this.messages.pokemon.visible=!0):this.messages.pokemon.visible=!1}drawWithWhoMessages(e){const t=this.messages.withWho,n=t[0].texture.width,i=t[0].texture.height;if(0!==e){if(e>70){this.selectedWithWhoMessageSizeIncrement<10&&(this.selectedWithWhoMessageSizeIncrement+=1);for(let e=0;e<2;e++){const s=Number(this.selectedWithWho===e),o=s*(this.selectedWithWhoMessageSizeIncrement+2),a=s*this.selectedWithWhoMessageSizeIncrement;t[e].visible=!0,t[e].x=216-n/2-o,t[e].y=184+30*e-a,t[e].width=n+2*o,t[e].height=i+2*a}}}else for(let e=0;e<2;e++)t[e].visible=!1}selectWithWho(e){this.selectedWithWho=e,this.selectedWithWhoMessageSizeIncrement=2}}class l{constructor(e){const t=e[a.a.SPRITE_SHEET].textures;this.bgContainer=function(e){const t=new s.Container;let n,i=e[r.SKY_BLUE];for(let e=0;e<12;e++)for(let o=0;o<27;o++)n=new s.Sprite(i),p(t,n,16*o,16*e);i=e[r.MOUNTAIN],n=new s.Sprite(i),p(t,n,0,188),i=e[r.GROUND_RED];for(let e=0;e<27;e++)n=new s.Sprite(i),p(t,n,16*e,248);i=e[r.GROUND_LINE];for(let e=1;e<26;e++)n=new s.Sprite(i),p(t,n,16*e,264);i=e[r.GROUND_LINE_LEFT_MOST],n=new s.Sprite(i),p(t,n,0,264),i=e[r.GROUND_LINE_RIGHT_MOST],n=new s.Sprite(i),p(t,n,416,264),i=e[r.GROUND_YELLOW];for(let e=0;e<2;e++)for(let o=0;o<27;o++)n=new s.Sprite(i),p(t,n,16*o,280+16*e);i=e[r.NET_PILLAR_TOP],n=new s.Sprite(i),p(t,n,213,176),i=e[r.NET_PILLAR];for(let e=0;e<12;e++)n=new s.Sprite(i),p(t,n,213,184+8*e);return t}(t);const n=function(e){const t=(t,n)=>e[r.PIKACHU(t,n)],n=[];for(let e=0;e<7;e++)if(3===e)n.push(t(e,0)),n.push(t(e,1));else if(4===e)n.push(t(e,0));else for(let i=0;i<5;i++)n.push(t(e,i));const i=new s.AnimatedSprite(n,!1),o=new s.AnimatedSprite(n,!1);return i.anchor.x=.5,i.anchor.y=.5,o.anchor.x=.5,o.anchor.y=.5,[i,o]}(t);this.player1=n[0],this.player2=n[1],this.ball=function(e){const t=t=>e[r.BALL(t)],n=[t(0),t(1),t(2),t(3),t(4),t("hyper")],i=new s.AnimatedSprite(n,!1);return i.anchor.x=.5,i.anchor.y=.5,i}(t),this.ballHyper=h(t,r.BALL_HYPER,.5,.5),this.ballTrail=h(t,r.BALL_TRAIL,.5,.5),this.punch=h(t,r.BALL_PUNCH,.5,.5),this.scoreBoards=[m(t),m(t)],this.shadows={forPlayer1:h(t,r.SHADOW,.5,.5),forPlayer2:h(t,r.SHADOW,.5,.5),forBall:h(t,r.SHADOW,.5,.5)},this.messages={gameStart:h(t,r.GAME_START,0,0),ready:h(t,r.READY,0,0),gameEnd:h(t,r.GAME_END,0,0)},this.cloudContainer=function(e){const t=new s.Container,n=e[r.CLOUD];for(let e=0;e<10;e++){const e=new s.Sprite(n);e.anchor.x=0,e.anchor.y=0,t.addChild(e)}return t}(t),this.waveContainer=function(e){const t=new s.Container,n=e[r.WAVE];for(let e=0;e<27;e++){const i=new s.Sprite(n);p(t,i,16*e,0)}return t}(t),this.container=new s.Container,this.container.addChild(this.bgContainer),this.container.addChild(this.cloudContainer),this.container.addChild(this.waveContainer),this.container.addChild(this.shadows.forPlayer1),this.container.addChild(this.shadows.forPlayer2),this.container.addChild(this.shadows.forBall),this.container.addChild(this.player1),this.container.addChild(this.player2),this.container.addChild(this.ballTrail),this.container.addChild(this.ballHyper),this.container.addChild(this.ball),this.container.addChild(this.punch),this.container.addChild(this.scoreBoards[0]),this.container.addChild(this.scoreBoards[1]),this.container.addChild(this.messages.gameStart),this.container.addChild(this.messages.ready),this.container.addChild(this.messages.gameEnd),this.bgContainer.x=0,this.bgContainer.y=0,this.cloudContainer.x=0,this.cloudContainer.y=0,this.waveContainer.x=0,this.waveContainer.y=0,this.messages.ready.x=176,this.messages.ready.y=38,this.scoreBoards[0].x=14,this.scoreBoards[0].y=10,this.scoreBoards[1].x=354,this.scoreBoards[1].y=10,this.shadows.forPlayer1.y=273,this.shadows.forPlayer2.y=273,this.shadows.forBall.y=273,this.initializeVisibles(),this.cloudArray=[];for(let e=0;e<10;e++)this.cloudArray.push(new o.a);this.wave=new o.b}get visible(){return this.container.visible}set visible(e){this.container.visible=e,!1===e&&this.initializeVisibles()}initializeVisibles(){for(const e in this.messages)this.messages[e].visible=!1}drawPlayersAndBall(e){const t=e.player1,n=e.player2,i=e.ball;this.player1.x=t.x,this.player1.y=t.y,3===t.state||4===t.state?this.player1.scale.x=-1===t.divingDirection?-1:1:this.player1.scale.x=1,this.shadows.forPlayer1.x=t.x,this.player2.x=n.x,this.player2.y=n.y,3===n.state||4===n.state?this.player2.scale.x=1===n.divingDirection?1:-1:this.player2.scale.x=-1,this.shadows.forPlayer2.x=n.x;const s=y(t.state,t.frameNumber),o=y(n.state,n.frameNumber);this.player1.gotoAndStop(s),this.player2.gotoAndStop(o),this.ball.x=i.x,this.ball.y=i.y,this.shadows.forBall.x=i.x,this.ball.gotoAndStop(i.rotation),i.punchEffectRadius>0?(i.punchEffectRadius-=2,this.punch.width=2*i.punchEffectRadius,this.punch.height=2*i.punchEffectRadius,this.punch.x=i.punchEffectX,this.punch.y=i.punchEffectY,this.punch.visible=!0):this.punch.visible=!1,!0===i.isPowerHit?(this.ballHyper.x=i.previousX,this.ballHyper.y=i.previousY,this.ballTrail.x=i.previousPreviousX,this.ballTrail.y=i.previousPreviousY,this.ballHyper.visible=!0,this.ballTrail.visible=!0):(this.ballHyper.visible=!1,this.ballTrail.visible=!1)}drawScoresToScoreBoards(e){for(let t=0;t<2;t++){const n=this.scoreBoards[t],i=e[t],s=n.getChildAt(0),o=n.getChildAt(1);s.gotoAndStop(i%10),o.gotoAndStop(Math.floor(i/10)%10),o.visible=i>=10}}drawCloudsAndWave(){const e=this.cloudArray,t=this.wave;Object(o.c)(e,t);for(let t=0;t<10;t++){const n=e[t],i=this.cloudContainer.getChildAt(t);i.x=n.spriteTopLeftPointX,i.y=n.spriteTopLeftPointY,i.width=n.spriteWidth,i.height=n.spriteHeight}for(let e=0;e<27;e++){this.waveContainer.getChildAt(e).y=t.yCoords[e]}}drawGameStartMessage(e,t){if(0===e)this.messages.gameStart.visible=!0;else if(e>=t-1)return void(this.messages.gameStart.visible=!1);const n=this.messages.gameStart,i=n.texture.width,s=n.texture.height,o=Math.floor(i*e/50),a=Math.floor(s*e/50);n.x=216-o,n.y=50+2*a,n.width=2*o,n.height=2*a}drawReadyMessage(e){this.messages.ready.visible=e}toggleReadyMessage(){this.messages.ready.visible=!this.messages.ready.visible}drawGameEndMessage(e){const t=this.messages.gameEnd,n=t.texture.width,i=t.texture.height;if(0===e&&(t.visible=!0),e<50){const s=2*Math.floor((50-e)*n/50),o=2*Math.floor((50-e)*i/50);t.x=216-n/2-s,t.y=50-o,t.width=n+2*s,t.height=i+2*o}else t.x=216-n/2,t.y=50,t.width=n,t.height=i}}class u{constructor(){this.black=new s.Graphics,this.black.beginFill(0),this.black.drawRect(0,0,432,304),this.black.endFill(),this.black.x=0,this.black.y=0,this.black.alpha=1}get visible(){return this.black.visible}set visible(e){this.black.visible=e}setBlackAlphaTo(e){this.black.alpha=e,0===this.black.alpha?this.black.visible=!1:this.black.visible=!0}changeBlackAlphaBy(e){this.black.alpha=e>=0?Math.min(1,this.black.alpha+e):Math.max(0,this.black.alpha+e),0===this.black.alpha?this.black.visible=!1:this.black.visible=!0}}function h(e,t,n,i){const o=new s.Sprite(e[t]);return o.anchor.x=n,o.anchor.y=i,o}function m(e){const t=[];for(let i=0;i<10;i++)t.push((n=i,e[r.NUMBER(n)]));var n;const i=[null,null];i[0]=new s.AnimatedSprite(t,!1),i[1]=new s.AnimatedSprite(t,!1);const o=new s.Container;return p(o,i[0],32,0),p(o,i[1],0,0),o.setChildIndex(i[0],0),o.setChildIndex(i[1],1),o}function p(e,t,n,i){e.addChild(t),t.anchor.x=0,t.anchor.y=0,t.x=n,t.y=i}function y(e,t){return e<4?5*e+t:4===e?17+t:e>4?18+5*(e-5)+t:void 0}var g=n(34),f=n(24);const b=a.a.SOUNDS;class w{constructor(e){this.sounds={bgm:new v(e[b.BGM].sound),pipikachu:new v(e[b.PIPIKACHU].sound),pika:new v(e[b.PIKA].sound),chu:new v(e[b.CHU].sound),pi:new v(e[b.PI].sound),pikachu:new v(e[b.PIKACHU].sound),powerHit:new v(e[b.POWERHIT].sound),ballTouchesGround:new v(e[b.BALLTOUCHESGROUND].sound)},this.sounds.bgm.loop=!0,this.properBGMVolume=.2,this.properSFXVolume=.35,this.adjustVolume()}adjustVolume(){for(const e in this.sounds)this.sounds[e].volume="bgm"===e?this.properBGMVolume:this.properSFXVolume}turnBGMVolume(e){let t;t=e?this.properBGMVolume:0,this.sounds.bgm.volume=t}turnSFXVolume(e){let t;t=e?this.properSFXVolume:0;for(const e in this.sounds)"bgm"!==e&&(this.sounds[e].volume=t)}}class v{constructor(e){this.center=e,this.left=f.a.Sound.from(e.url),this.right=f.a.Sound.from(e.url);const t=new f.a.filters.StereoFilter(0),n=new f.a.filters.StereoFilter(-.75),i=new f.a.filters.StereoFilter(.75);this.center.filters=[t],this.left.filters=[n],this.right.filters=[i]}set volume(e){this.center.volume=e,this.left.volume=e,this.right.volume=e}set loop(e){this.center.loop=e,this.left.loop=e,this.right.loop=e}play(e=0){0===e?this.center.play():-1===e?this.left.play():1===e&&this.right.play()}stop(){this.center.stop(),this.left.stop(),this.right.stop()}}class k{constructor(e,t){this.view={intro:new c(t),menu:new d(t),game:new l(t),fadeInOut:new u},e.addChild(this.view.intro.container),e.addChild(this.view.menu.container),e.addChild(this.view.game.container),e.addChild(this.view.fadeInOut.black),this.view.intro.visible=!1,this.view.menu.visible=!1,this.view.game.visible=!1,this.view.fadeInOut.visible=!1,this.audio=new w(t),this.physics=new i.a(!0,!0),this.keyboardArray=[new g.a("KeyD","KeyG","KeyR","KeyV","KeyZ","KeyF"),new g.a("ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter")],this.normalFPS=25,this.slowMotionFPS=5,this.SLOW_MOTION_FRAMES_NUM=6,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.selectedWithWho=0,this.scores=[0,0],this.winningScore=15,this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.frameCounter=0,this.frameTotal={intro:165,afterMenuSelection:15,beforeStartOfNewGame:15,startOfNewGame:71,afterEndOfRound:5,beforeStartOfNextRound:30,gameEnd:211},this.noInputFrameCounter=0,this.noInputFrameTotal={menu:225},this.paused=!1,this.isStereoSound=!0,this._isPracticeMode=!1,this.state=this.intro}gameLoop(){if(!0!==this.paused){if(this.slowMotionFramesLeft>0){if(this.slowMotionNumOfSkippedFrames++,this.slowMotionNumOfSkippedFrames%Math.round(this.normalFPS/this.slowMotionFPS)!=0)return;this.slowMotionFramesLeft--,this.slowMotionNumOfSkippedFrames=0}this.keyboardArray[0].getInput(),this.keyboardArray[1].getInput(),this.state()}}intro(){0===this.frameCounter&&(this.view.intro.visible=!0,this.view.fadeInOut.setBlackAlphaTo(0),this.audio.sounds.bgm.stop()),this.view.intro.drawMark(this.frameCounter),this.frameCounter++,1!==this.keyboardArray[0].powerHit&&1!==this.keyboardArray[1].powerHit||(this.frameCounter=0,this.view.intro.visible=!1,this.state=this.menu),this.frameCounter>=this.frameTotal.intro&&(this.frameCounter=0,this.view.intro.visible=!1,this.state=this.menu)}menu(){if(0===this.frameCounter&&(this.view.menu.visible=!0,this.view.fadeInOut.setBlackAlphaTo(0),this.selectedWithWho=0,this.view.menu.selectWithWho(this.selectedWithWho)),this.view.menu.drawFightMessage(this.frameCounter),this.view.menu.drawSachisoft(this.frameCounter),this.view.menu.drawSittingPikachuTiles(this.frameCounter),this.view.menu.drawPikachuVolleyballMessage(this.frameCounter),this.view.menu.drawPokemonMessage(this.frameCounter),this.view.menu.drawWithWhoMessages(this.frameCounter),this.frameCounter++,this.frameCounter<71&&(1===this.keyboardArray[0].powerHit||1===this.keyboardArray[1].powerHit))this.frameCounter=71;else if(!(this.frameCounter<=71)){if(-1!==this.keyboardArray[0].yDirection&&-1!==this.keyboardArray[1].yDirection||1!==this.selectedWithWho?1!==this.keyboardArray[0].yDirection&&1!==this.keyboardArray[1].yDirection||0!==this.selectedWithWho?this.noInputFrameCounter++:(this.noInputFrameCounter=0,this.selectedWithWho=1,this.view.menu.selectWithWho(this.selectedWithWho),this.audio.sounds.pi.play()):(this.noInputFrameCounter=0,this.selectedWithWho=0,this.view.menu.selectWithWho(this.selectedWithWho),this.audio.sounds.pi.play()),1===this.keyboardArray[0].powerHit||1===this.keyboardArray[1].powerHit)return 1===this.selectedWithWho?(this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1):1===this.keyboardArray[0].powerHit?(this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!0):1===this.keyboardArray[1].powerHit&&(this.physics.player1.isComputer=!0,this.physics.player2.isComputer=!1),this.audio.sounds.pikachu.play(),this.frameCounter=0,this.noInputFrameCounter=0,void(this.state=this.afterMenuSelection);this.noInputFrameCounter>=this.noInputFrameTotal.menu&&(this.physics.player1.isComputer=!0,this.physics.player2.isComputer=!0,this.frameCounter=0,this.noInputFrameCounter=0,this.state=this.afterMenuSelection)}}afterMenuSelection(){this.view.fadeInOut.changeBlackAlphaBy(1/16),this.frameCounter++,this.frameCounter>=this.frameTotal.afterMenuSelection&&(this.frameCounter=0,this.state=this.beforeStartOfNewGame)}beforeStartOfNewGame(){this.frameCounter++,this.frameCounter>=this.frameTotal.beforeStartOfNewGame&&(this.frameCounter=0,this.view.menu.visible=!1,this.state=this.startOfNewGame)}startOfNewGame(){0===this.frameCounter&&(this.view.game.visible=!0,this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.physics.player1.gameEnded=!1,this.physics.player1.isWinner=!1,this.physics.player2.gameEnded=!1,this.physics.player2.isWinner=!1,this.scores[0]=0,this.scores[1]=0,this.view.game.drawScoresToScoreBoards(this.scores),this.physics.player1.initializeForNewRound(),this.physics.player2.initializeForNewRound(),this.physics.ball.initializeForNewRound(this.isPlayer2Serve),this.view.game.drawPlayersAndBall(this.physics),this.view.fadeInOut.setBlackAlphaTo(1),this.audio.sounds.bgm.play()),this.view.game.drawGameStartMessage(this.frameCounter,this.frameTotal.startOfNewGame),this.view.game.drawCloudsAndWave(),this.view.fadeInOut.changeBlackAlphaBy(-1/17),this.frameCounter++,this.frameCounter>=this.frameTotal.startOfNewGame&&(this.frameCounter=0,this.view.fadeInOut.setBlackAlphaTo(0),this.state=this.round)}round(){const e=1===this.keyboardArray[0].powerHit||1===this.keyboardArray[1].powerHit;if(!0===this.physics.player1.isComputer&&!0===this.physics.player2.isComputer&&e)return this.frameCounter=0,this.view.game.visible=!1,void(this.state=this.intro);const t=this.physics.runEngineForNextFrame(this.keyboardArray);if(this.playSoundEffect(),this.view.game.drawPlayersAndBall(this.physics),this.view.game.drawCloudsAndWave(),!0===this.gameEnded)return this.view.game.drawGameEndMessage(this.frameCounter),this.frameCounter++,void((this.frameCounter>=this.frameTotal.gameEnd||this.frameCounter>=70&&e)&&(this.frameCounter=0,this.view.game.visible=!1,this.state=this.intro));t&&!1===this._isPracticeMode&&!1===this.roundEnded&&!1===this.gameEnded&&(this.physics.ball.punchEffectX<216?(this.isPlayer2Serve=!0,this.scores[1]+=1,this.scores[1]>=this.winningScore&&(this.gameEnded=!0,this.physics.player1.isWinner=!1,this.physics.player2.isWinner=!0,this.physics.player1.gameEnded=!0,this.physics.player2.gameEnded=!0)):(this.isPlayer2Serve=!1,this.scores[0]+=1,this.scores[0]>=this.winningScore&&(this.gameEnded=!0,this.physics.player1.isWinner=!0,this.physics.player2.isWinner=!1,this.physics.player1.gameEnded=!0,this.physics.player2.gameEnded=!0)),this.view.game.drawScoresToScoreBoards(this.scores),!1===this.roundEnded&&!1===this.gameEnded&&(this.slowMotionFramesLeft=this.SLOW_MOTION_FRAMES_NUM),this.roundEnded=!0),!0===this.roundEnded&&!1===this.gameEnded&&0===this.slowMotionFramesLeft&&(this.view.fadeInOut.changeBlackAlphaBy(1/16),this.state=this.afterEndOfRound)}afterEndOfRound(){this.view.fadeInOut.changeBlackAlphaBy(1/16),this.frameCounter++,this.frameCounter>=this.frameTotal.afterEndOfRound&&(this.frameCounter=0,this.state=this.beforeStartOfNextRound)}beforeStartOfNextRound(){0===this.frameCounter&&(this.view.fadeInOut.setBlackAlphaTo(1),this.view.game.drawReadyMessage(!1),this.physics.player1.initializeForNewRound(),this.physics.player2.initializeForNewRound(),this.physics.ball.initializeForNewRound(this.isPlayer2Serve),this.view.game.drawPlayersAndBall(this.physics)),this.view.game.drawCloudsAndWave(),this.view.fadeInOut.changeBlackAlphaBy(-1/16),this.frameCounter++,this.frameCounter%5==0&&this.view.game.toggleReadyMessage(),this.frameCounter>=this.frameTotal.beforeStartOfNextRound&&(this.frameCounter=0,this.view.game.drawReadyMessage(!1),this.view.fadeInOut.setBlackAlphaTo(0),this.roundEnded=!1,this.state=this.round)}playSoundEffect(){const e=this.audio;for(let t=0;t<2;t++){const n=this.physics["player"+(t+1)].sound;let i=0;this.isStereoSound&&(i=0===t?-1:1),!0===n.pipikachu&&(e.sounds.pipikachu.play(i),n.pipikachu=!1),!0===n.pika&&(e.sounds.pika.play(i),n.pika=!1),!0===n.chu&&(e.sounds.chu.play(i),n.chu=!1)}const t=this.physics.ball,n=t.sound;let i=0;this.isStereoSound&&(t.punchEffectX<216?i=-1:t.punchEffectX>216&&(i=1)),!0===n.powerHit&&(e.sounds.powerHit.play(i),n.powerHit=!1),!0===n.ballTouchesGround&&(e.sounds.ballTouchesGround.play(i),n.ballTouchesGround=!1)}restart(){this.frameCounter=0,this.noInputFrameCounter=0,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.view.menu.visible=!1,this.view.game.visible=!1,this.state=this.intro}get isPracticeMode(){return this._isPracticeMode}set isPracticeMode(e){this._isPracticeMode=e,this.view.game.scoreBoards[0].visible=!e,this.view.game.scoreBoards[1].visible=!e}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){}]]);
//# sourceMappingURL=main~main_replay.985460e2f8eaa640924f.js.map