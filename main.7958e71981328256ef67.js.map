{"version":3,"sources":["webpack:///./src/resources/js/pikavolley_online.js","webpack:///./src/resources/js/gamepad.js","webpack:///./src/resources/js/main_online.js","webpack:///./src/resources/js/app.js","webpack:///./node_modules/fontfaceobserver/fontfaceobserver.standalone.js"],"names":["stage","resources","super","this","physics","player1","isComputer","player2","keyboardArray","unsubscribe","myKeyboard","myOnlineKeyboard","inputQueue","peerOnlineKeyboard","peerInputQueue","_amIPlayer2","_syncCounter","noInputFrameTotal","menu","Infinity","isFirstGame","willSaveReplay","bool","amIPlayer2","counter","mod","frameCounter","selectedWithWho","amICreatedRoom","isQuickMatch","intro","myNickname","peerNickname","myPartialPublicIP","peerPartialPublicIP","gameStartAllowed","isOpen","getInputIfNeededAndSendToPeer","syncCounter","gameLoopFromGettingPeerInput","isInputOnQueue","callbackAfterPeerInputQueueReceived","bind","getInput","player1Input","xDirection","yDirection","powerHit","player2Input","recordInputs","slowMotionFramesLeft","slowMotionNumOfSkippedFrames","Math","round","normalFPS","slowMotionFPS","state","length","window","setTimeout","gameLoop","D_PAD_PRESSED_KEY","background","beginFill","drawRect","addChild","dPadStyle","fontFamily","fontSize","fontStyle","fill","wordWrap","wordWrapWidth","btnStyle","dPadView","x","y","dPadPressed","dPadPressedBefore","dPadLabelText","isDPadPressed","dPadTouch","EMPTY","anchor","width","height","buttonMode","interactive","on","evt","console","log","updateDPadPressed","renderDPadLabel","startDPadPressed","endDPadPressed","i","data","getLocalPosition","distance","hypot","dot","det","angle","atan2","PI","dispatchEvent","KeyboardEvent","code","dPadLabel","text","aTouch","target","scale","bTouch","PIXI","TEXTURES","WITH_COMPUTER","WITH_FRIEND","settings","RESOLUTION","devicePixelRatio","SCALE_MODE","NEAREST","ROUND_PIXELS","innerWidth","innerHeight","antialias","backgroundColor","transparent","resolution","ticker","loader","font","document","querySelector","appendChild","view","app","renderer","gamePad","initApp","initStage","gamepad","initGamepad","appView","mask","render","add","SPRITE_SHEET","prop","SOUNDS","setup","pikaVolley","maxFPS","start","loadingBox","getElementById","progressBar","onProgress","style","progress","onComplete","classList","contains","setUpLoaderProgresBar","callbackAfterDataChannelOpened","load","then","init","l","a","b","addEventListener","attachEvent","t","createElement","setAttribute","createTextNode","c","h","f","g","cssText","u","z","offsetWidth","scrollLeft","scrollWidth","A","k","parentNode","B","family","weight","stretch","C","D","E","F","J","fonts","K","L","join","prototype","r","n","H","Date","getTime","Promise","test","navigator","vendor","exec","userAgent","parseInt","G","M","e","Error","N","race","clearTimeout","body","removeEventListener","readyState","detachEvent","m","v","w","d","removeChild","p","q","dir","I","hidden","module","exports"],"mappings":"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","file":"main.7958e71981328256ef67.js","sourcesContent":["'use strict';\nimport { PikachuVolleyball } from './offline_version_js/pikavolley.js';\nimport { bufferLength, myKeyboard, OnlineKeyboard } from './keyboard_online.js';\nimport { SYNC_DIVISOR, channel } from './data_channel/data_channel';\nimport { mod } from './utils/mod.js';\nimport { askOneMoreGame } from './ui_online.js';\nimport { displayPartialIPFor, displayNicknameFor } from './nickname_display.js';\nimport { replaySaver } from './replay/replay_saver.js';\nimport { PikaUserInput } from './offline_version_js/physics.js';\n\n/** @typedef GameState @type {function():void} */\n\n/**\n * Class reperesenting Pikachu Volleyball p2p online game\n */\n// @ts-ignore\nexport class PikachuVolleyballOnline extends PikachuVolleyball {\n  constructor(stage, resources) {\n    super(stage, resources);\n    this.physics.player1.isComputer = false;\n    this.physics.player2.isComputer = false;\n\n    // @ts-ignore\n    this.keyboardArray[0].unsubscribe();\n    // @ts-ignore\n    this.keyboardArray[1].unsubscribe();\n\n    this.myKeyboard = myKeyboard;\n    this.myOnlineKeyboard = new OnlineKeyboard(this.myKeyboard.inputQueue);\n    this.peerOnlineKeyboard = new OnlineKeyboard(channel.peerInputQueue);\n\n    this._amIPlayer2 = false;\n    this.keyboardArray = [this.myOnlineKeyboard, this.peerOnlineKeyboard];\n    this._syncCounter = 0;\n    this.noInputFrameTotal.menu = Infinity;\n\n    this.isFirstGame = true;\n\n    this.willSaveReplay = true;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  get amIPlayer2() {\n    return this._amIPlayer2;\n  }\n\n  /**\n   * @param {boolean} bool Am I Player 2? Am I play on the right side?\n   */\n  set amIPlayer2(bool) {\n    this._amIPlayer2 = bool;\n    channel.amIPlayer2 = bool;\n    if (this._amIPlayer2 === true) {\n      this.keyboardArray = [this.peerOnlineKeyboard, this.myOnlineKeyboard];\n    } else {\n      this.keyboardArray = [this.myOnlineKeyboard, this.peerOnlineKeyboard];\n    }\n  }\n\n  get syncCounter() {\n    return this._syncCounter;\n  }\n\n  set syncCounter(counter) {\n    this._syncCounter = mod(counter, SYNC_DIVISOR);\n  }\n\n  /**\n   * Override the \"intro\" method in the super class.\n   * It is to ask for one more game with the peer after quick match game ends.\n   * @type {GameState}\n   */\n  intro() {\n    if (this.frameCounter === 0) {\n      this.selectedWithWho = 0;\n      if (this.isFirstGame) {\n        this.isFirstGame = false;\n        this.amIPlayer2 = !channel.amICreatedRoom;\n      } else if (channel.isQuickMatch) {\n        askOneMoreGame();\n      }\n    }\n    super.intro();\n  }\n\n  /**\n   * Override the \"menu\" method in the super class.\n   * It changes \"am I player 1 or player 2\" setting accordingly.\n   * @type {GameState}\n   */\n  menu() {\n    const selectedWithWho = this.selectedWithWho;\n    super.menu();\n    if (this.selectedWithWho !== selectedWithWho) {\n      this.amIPlayer2 = !this.amIPlayer2;\n      displayNicknameFor(channel.myNickname, this.amIPlayer2);\n      displayNicknameFor(channel.peerNickname, !this.amIPlayer2);\n      displayPartialIPFor(channel.myPartialPublicIP, this.amIPlayer2);\n      displayPartialIPFor(channel.peerPartialPublicIP, !this.amIPlayer2);\n    }\n  }\n\n  /**\n   * Game loop\n   * This function should be called at regular intervals ( interval = (1 / FPS) second )\n   */\n  gameLoop() {\n    if (!(channel.gameStartAllowed && channel.isOpen)) {\n      return;\n    }\n\n    // Sync game frame and user input with peer\n    //\n    // This must be before the slow-mo effect.\n    // Otherwise, frame sync could be broken,\n    // for example, if peer use other tap on the browser\n    // so peer's game pause while my game goes on slow-mo.\n    // This broken frame sync results into different game state between two peers.\n    this.myKeyboard.getInputIfNeededAndSendToPeer(this.syncCounter);\n    this.gameLoopFromGettingPeerInput();\n  }\n\n  gameLoopFromGettingPeerInput() {\n    const checkForPeerInputQueue = this.peerOnlineKeyboard.isInputOnQueue(\n      this.syncCounter\n    );\n    if (!checkForPeerInputQueue) {\n      channel.callbackAfterPeerInputQueueReceived = this.gameLoopFromGettingPeerInput.bind(\n        this\n      );\n      return;\n    }\n    const checkForMyInputQueue = this.myOnlineKeyboard.isInputOnQueue(\n      this.syncCounter\n    );\n    if (!checkForMyInputQueue) {\n      return;\n    }\n    this.peerOnlineKeyboard.getInput(this.syncCounter);\n    this.myOnlineKeyboard.getInput(this.syncCounter);\n    this.syncCounter++;\n\n    if (this.willSaveReplay) {\n      const player1Input = new PikaUserInput();\n      player1Input.xDirection = this.keyboardArray[0].xDirection;\n      player1Input.yDirection = this.keyboardArray[0].yDirection;\n      player1Input.powerHit = this.keyboardArray[0].powerHit;\n      const player2Input = new PikaUserInput();\n      player2Input.xDirection = this.keyboardArray[1].xDirection;\n      player2Input.yDirection = this.keyboardArray[1].yDirection;\n      player2Input.powerHit = this.keyboardArray[1].powerHit;\n      replaySaver.recordInputs(player1Input, player2Input);\n    }\n\n    // slow-mo effect\n    if (this.slowMotionFramesLeft > 0) {\n      this.slowMotionNumOfSkippedFrames++;\n      if (\n        this.slowMotionNumOfSkippedFrames %\n          Math.round(this.normalFPS / this.slowMotionFPS) !==\n        0\n      ) {\n        return;\n      }\n      this.slowMotionFramesLeft--;\n      this.slowMotionNumOfSkippedFrames = 0;\n    }\n\n    this.physics.player1.isComputer = false;\n    this.physics.player2.isComputer = false;\n    this.state();\n\n    // window.setTimeout(callback, 0) is used because it puts\n    // the callback to the message queue of Javascript runtime event loop,\n    // so the callback does not stack upon the stack of the caller function and\n    // also does not block if the callbacks are called a bunch in a row.\n    if (this.peerOnlineKeyboard.inputQueue.length > bufferLength) {\n      if (this.myOnlineKeyboard.inputQueue.length > bufferLength) {\n        window.setTimeout(this.gameLoopFromGettingPeerInput.bind(this), 0);\n      } else {\n        window.setTimeout(this.gameLoop.bind(this), 0);\n      }\n    }\n  }\n}\n","import * as PIXI from 'pixi.js-legacy';\n\nconst GAMEPAD_VIEW_WIDTH = 480;\nconst GAMEPAD_VIEW_HEIGHT = 800;\n\nconst PRESS_UP_IDX = 0;\nconst PRESS_DOWN_IDX = 1;\nconst PRESS_LEFT_IDX = 2;\nconst PRESS_RIGHT_IDX = 3;\n\nconst D_PAD_PRESSED_KEY = ['KeyR', 'KeyF', 'KeyD', 'KeyG'];\nconst ACTION_KEY = 'KeyZ';\n\nconst DEAD_ZONE = 20;\nconst PRESS_ZONE = 90;\n\nexport class Gamepad extends PIXI.Container {\n  constructor() {\n    super();\n  }\n\n  init() {\n    const background = new PIXI.Graphics();\n    background.beginFill(0x0d2e41);\n    background.drawRect(0, 0, GAMEPAD_VIEW_WIDTH, GAMEPAD_VIEW_HEIGHT);\n    this.addChild(background);\n\n    const dPadStyle = new PIXI.TextStyle({\n      fontFamily: 'game-boy',\n      fontSize: 200,\n      fontStyle: '',\n      fill: ['#44AD9F'],\n      wordWrap: true,\n      wordWrapWidth: 440,\n    });\n\n    const btnStyle = new PIXI.TextStyle({\n      fontFamily: 'game-boy',\n      fontSize: 90,\n      fontStyle: '',\n      fill: ['#44AD9F'],\n      wordWrap: true,\n      wordWrapWidth: 440,\n    });\n\n    const dPadView = new PIXI.Container();\n    dPadView.x = 120;\n    dPadView.y = 150;\n    this.addChild(dPadView);\n\n    const dPadPressed = [false, false, false, false];\n    const dPadPressedBefore = [false, false, false, false];\n    let dPadLabelText = 'S';\n    let isDPadPressed = false;\n\n    const dPadTouch = new PIXI.Sprite(PIXI.Texture.EMPTY);\n    dPadTouch.anchor.x = 0.5;\n    dPadTouch.anchor.y = 0.5;\n    dPadTouch.x = 0;\n    dPadTouch.y = 0;\n    dPadTouch.width = 180;\n    dPadTouch.height = 220;\n    dPadTouch.buttonMode = true;\n    dPadTouch.interactive = true;\n    dPadTouch.on('pointermove', (evt) => {\n      console.log('pointermove');\n\n      if (!isDPadPressed) {\n        return;\n      }\n\n      updateDPadPressed(evt);\n      renderDPadLabel();\n    });\n    dPadTouch.on('pointerdown', (evt) => {\n      console.log('pointerdown');\n\n      isDPadPressed = true;\n\n      startDPadPressed();\n      updateDPadPressed(evt);\n      renderDPadLabel();\n    });\n    dPadTouch.on('pointerup', () => {\n      console.log('pointerup');\n\n      isDPadPressed = false;\n\n      endDPadPressed();\n      renderDPadLabel();\n    });\n    dPadTouch.on('pointerupoutside', () => {\n      console.log('pointerupoutside');\n\n      isDPadPressed = false;\n\n      endDPadPressed();\n      renderDPadLabel();\n    });\n    dPadView.addChild(dPadTouch);\n\n    const startDPadPressed = () => {\n      for (let i = 0; i < dPadPressed.length; i++) {\n        dPadPressed[i] = false;\n        dPadPressedBefore[i] = false;\n      }\n    };\n\n    const updateDPadPressed = (evt) => {\n      const { x, y } = evt.data.getLocalPosition(dPadView);\n\n      const distance = Math.hypot(x, y);\n      if (distance < DEAD_ZONE) {\n        return;\n      }\n\n      if (distance > PRESS_ZONE) {\n        return;\n      }\n\n      for (let i = 0; i < dPadPressedBefore.length; i++) {\n        dPadPressedBefore[i] = false;\n      }\n\n      const x1 = x;\n      const y1 = y;\n      const x2 = -1;\n      const y2 = 0;\n\n      const dot = x1 * x2 + y1 * y2;\n      const det = x1 * y2 - y1 * x2;\n      const angle = (Math.atan2(det, dot) * 180) / Math.PI + 180;\n\n      if (angle < 15 || angle > 345) {\n        // right\n        console.log('→');\n        dPadPressedBefore[PRESS_RIGHT_IDX] = true;\n        dPadLabelText = 'D';\n      } else if (angle >= 15 && angle <= 75) {\n        // up-right\n        console.log('↗︎');\n        dPadPressedBefore[PRESS_UP_IDX] = true;\n        dPadPressedBefore[PRESS_RIGHT_IDX] = true;\n        dPadLabelText = 'E';\n      } else if (angle > 75 && angle < 105) {\n        // up\n        console.log('↑');\n        dPadPressedBefore[PRESS_UP_IDX] = true;\n        dPadLabelText = 'W';\n      } else if (angle >= 105 && angle < 165) {\n        // up-left\n        console.log('↖︎');\n        dPadPressedBefore[PRESS_UP_IDX] = true;\n        dPadPressedBefore[PRESS_LEFT_IDX] = true;\n        dPadLabelText = 'Q';\n      } else if (angle > 165 && angle < 195) {\n        // left\n        console.log('←');\n        dPadPressedBefore[PRESS_LEFT_IDX] = true;\n        dPadLabelText = 'A';\n      } else if (angle >= 195 && angle <= 255) {\n        // down-left\n        console.log('↙︎');\n        dPadPressedBefore[PRESS_DOWN_IDX] = true;\n        dPadPressedBefore[PRESS_LEFT_IDX] = true;\n        dPadLabelText = 'Z';\n      } else if (angle > 255 && angle < 285) {\n        // down\n        console.log('↓');\n        dPadPressedBefore[PRESS_DOWN_IDX] = true;\n        dPadLabelText = 'X';\n      } else if (angle >= 285 && angle <= 345) {\n        // down-right\n        console.log('↘︎');\n        dPadPressedBefore[PRESS_DOWN_IDX] = true;\n        dPadPressedBefore[PRESS_RIGHT_IDX] = true;\n        dPadLabelText = 'C';\n      }\n\n      for (let i = 0; i < dPadPressed.length; i++) {\n        if (dPadPressedBefore[i] && !dPadPressed[i]) {\n          window.dispatchEvent(\n            new KeyboardEvent('keydown', { code: D_PAD_PRESSED_KEY[i] })\n          );\n        } else if (!dPadPressedBefore[i] && dPadPressed[i]) {\n          window.dispatchEvent(\n            new KeyboardEvent('keyup', { code: D_PAD_PRESSED_KEY[i] })\n          );\n        }\n\n        dPadPressed[i] = dPadPressedBefore[i];\n      }\n    };\n\n    const endDPadPressed = () => {\n      for (let i = 0; i < dPadPressed.length; i++) {\n        if (dPadPressed[i]) {\n          window.dispatchEvent(\n            new KeyboardEvent('keyup', { code: D_PAD_PRESSED_KEY[i] })\n          );\n        }\n      }\n\n      dPadLabelText = 'S';\n    };\n\n    const renderDPadLabel = () => {\n      dPadLabel.text = dPadLabelText;\n    };\n\n    const dPadLabel = new PIXI.Text('S', dPadStyle);\n    dPadLabel.anchor.x = 0.5;\n    dPadLabel.anchor.y = 0.5;\n    dPadLabel.x = 0;\n    dPadLabel.y = -7;\n    dPadView.addChild(dPadLabel);\n\n    // const dPadCircle = new PIXI.Graphics();\n    // dPadCircle.beginFill(0xffffff);\n    // dPadCircle.drawCircle(0, 0, PRESS_ZONE);\n    // dPadCircle.endFill();\n    // dPadView.addChild(dPadCircle)\n\n    const aTouch = new PIXI.Text('a', btnStyle);\n    aTouch.anchor.x = 0.5;\n    aTouch.anchor.y = 0.5;\n    aTouch.x = 290;\n    aTouch.y = 200;\n    aTouch.buttonMode = true;\n    aTouch.interactive = true;\n    aTouch.on('pointerdown', (evt) => {\n      window.dispatchEvent(new KeyboardEvent('keydown', { code: ACTION_KEY }));\n      evt.target.scale.x = 1.2;\n      evt.target.scale.y = 1.2;\n      evt.target.text = '\\u003c';\n    });\n    aTouch.on('pointerup', (evt) => {\n      window.dispatchEvent(new KeyboardEvent('keyup', { code: ACTION_KEY }));\n      evt.target.scale.x = 1;\n      evt.target.scale.y = 1;\n      evt.target.text = 'a';\n    });\n    aTouch.on('pointerupoutside', () => {\n      window.dispatchEvent(new KeyboardEvent('keyup', { code: ACTION_KEY }));\n      aTouch.scale.x = 1;\n      aTouch.scale.y = 1;\n      aTouch.text = 'b';\n    });\n    this.addChild(aTouch);\n\n    const bTouch = new PIXI.Text('b', btnStyle);\n    bTouch.anchor.x = 0.5;\n    bTouch.anchor.y = 0.5;\n    bTouch.x = 400;\n    bTouch.y = 150;\n    bTouch.buttonMode = true;\n    bTouch.interactive = true;\n    bTouch.on('pointerdown', (evt) => {\n      window.dispatchEvent(new KeyboardEvent('keydown', { code: ACTION_KEY }));\n      evt.target.scale.x = 1.2;\n      evt.target.scale.y = 1.2;\n      evt.target.text = '\\u003e';\n    });\n    bTouch.on('pointerup', (evt) => {\n      window.dispatchEvent(new KeyboardEvent('keyup', { code: ACTION_KEY }));\n      evt.target.scale.x = 1;\n      evt.target.scale.y = 1;\n      evt.target.text = 'b';\n    });\n    bTouch.on('pointerupoutside', () => {\n      window.dispatchEvent(new KeyboardEvent('keyup', { code: ACTION_KEY }));\n      bTouch.scale.x = 1;\n      bTouch.scale.y = 1;\n      bTouch.text = 'b';\n    });\n    this.addChild(bTouch);\n  }\n}\n","/**\n * This is the main script which executes the p2p online version game.\n * General explanations for the all source code files of the game are following.\n *\n ********************************************************************************************************************\n * This p2p online version of the Pikachu Volleyball is developed based on\n * the Pikachu Volleyball offline web version (https://github.com/gorisanson/pikachu-volleyball)\n * which is made by reverse engineering the core part of the original Pikachu Volleyball game\n * which is developed by \"1997 (C) SACHI SOFT / SAWAYAKAN Programmers\" & \"1997 (C) Satoshi Takenouchi\".\n ********************************************************************************************************************\n *\n * This p2p online version game is mainly composed of two parts below.\n *  1) Offline version: All the offline web version source code files is in the directory \"offline_version_js\".\n *  2) WebRTC data channels: It utilizes WebRTC data channels to communicate with the peer.\n *                           The peer-to-peer online functions are contained in \"data_channel.js\"\n *\n * The game is deterministic on the user (keyboard) inputs except the RNG (random number generator) used in\n * \"offline_version_js/physics.js\" and \"offline_version_js/cloud_and_wave.js\". (The RNG is contained\n * in \"offline_version_js/rand.js\".) So if the RNG is the same on both peers, only the user inputs need\n * to be communicated to maintain the same game state between the peers. In this p2p online version, the RNG\n * is set to the same thing on both peers at the data channel open event (handled by the function\n * \"dataChannelOpened\" in \"data_channel.js\"), then the user inputs are communicated via the data channel.\n *\n * And expainations for other source files are below.\n *  - \"pikavolley_online.js\": A wrapper for \"offline_version_js/pikavolley.js\".\n *  - \"keyboard_online.js\": A wrapper for offline version \"offline_version_js/keyboard.js\".\n *                          This module gets user inputs and load them up onto the data channel to the peer.\n *  - \"generate_pushid.js\": Generate a room ID easilly distinguishable by human eye.\n *  - \"mod.js\": To maintain game sync, sync counter is attached for each user input, and mod is used to\n *              make sync counter cycle in a range [0, 255] which fits in a byte.\n *  - \"ui_online.js\": For the user interface of the html page and inputs/outputs relevant to html elements.\n *  - \"chat_display.js\": For displaying chat messages.\n *  - \"firebase_config.template.js\": This p2p online version utilized firebase cloud firestore to establish\n *                                   webRTC data channel connection between peers. Fill this template and\n *                                   change the file name to \"firebase_config.js\".\n *  - \"rtc_configuration.js\": Contains RTCPeerConnection configuration.\n *  - \"quick_match.js\": It is for the quick match function. Manages communication with the quick match server.\n *  - \"qucik_match_server_url.template.js\": Fill this template the url of the quick match server and change\n *                                          the file name to \"qucik_match_server_url.js\"\n */\n\n'use strict';\nimport * as PIXI from 'pixi.js-legacy';\nimport 'pixi-sound';\nimport FontFaceObserver from 'fontfaceobserver';\nimport { PikachuVolleyballOnline } from './pikavolley_online.js';\nimport { ASSETS_PATH } from './offline_version_js/assets_path.js';\nimport { channel } from './data_channel/data_channel.js';\nimport { setUpUI, setUpUIAfterLoadingGameAssets } from './ui_online.js';\nimport { setParty } from './party_online';\nimport { setGetSpeechBubbleNeeded } from './chat_display.js';\nimport { App } from './app';\nimport { Gamepad } from './gamepad';\nimport '../style.css';\n\nwindow.PIXI = PIXI;\n\nconst TEXTURES = ASSETS_PATH.TEXTURES;\nTEXTURES.WITH_COMPUTER = TEXTURES.WITH_FRIEND;\n\nconst settings = PIXI.settings;\nsettings.RESOLUTION = window.devicePixelRatio;\nsettings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;\nsettings.ROUND_PIXELS = true;\n\nconst renderer = PIXI.autoDetectRenderer({\n  width: window.innerWidth,\n  height: window.innerHeight,\n  antialias: false,\n  backgroundColor: 0x000000,\n  transparent: false,\n  resolution: 1,\n});\nconst stage = new PIXI.Container();\nconst ticker = new PIXI.Ticker();\nconst loader = new PIXI.Loader();\n\nconst font = new FontFaceObserver('game-boy');\n\ndocument.querySelector('#game-canvas-container').appendChild(renderer.view);\n\nconst gamePad = new Gamepad();\nconst app = new App(renderer, stage, gamePad);\n\nrenderer.render(app.view);\n\n// renderer.render(stage); // To make the initial canvas painting stable in the Firefox browser.\nloader.add(ASSETS_PATH.SPRITE_SHEET);\nfor (const prop in ASSETS_PATH.SOUNDS) {\n  loader.add(ASSETS_PATH.SOUNDS[prop]);\n}\nsetUpLoaderProgresBar();\nchannel.callbackAfterDataChannelOpened = () => {\n  // loader.load(setup);\n  font.load()\n    .then(() => gamePad.init())\n    .then(() => loader.load(setup));\n};\n\nsetUpUI();\nsetParty();\n\n/**\n * Set up the loader progress bar.\n */\nfunction setUpLoaderProgresBar() {\n  const loadingBox = document.getElementById('loading-box');\n  const progressBar = document.getElementById('progress-bar');\n\n  loader.onProgress.add(() => {\n    progressBar.style.width = `${loader.progress}%`;\n  });\n  loader.onComplete.add(() => {\n    if (!loadingBox.classList.contains('hidden')) {\n      loadingBox.classList.add('hidden');\n    }\n  });\n}\n\nfunction setup() {\n  const pikaVolley = new PikachuVolleyballOnline(stage, loader.resources);\n  setUpUIAfterLoadingGameAssets(pikaVolley, ticker);\n  setGetSpeechBubbleNeeded(pikaVolley);\n  start(pikaVolley);\n}\n\nfunction start(pikaVolley) {\n  ticker.maxFPS = pikaVolley.normalFPS;\n  ticker.add(() => {\n    // Redering and gameLoop order is the opposite of\n    // the offline web version (refer: ./offline_version_js/main.js).\n    // It's for the smooth rendering for the online version\n    // which gameLoop can not always succeed right on this \"ticker.add\"ed code\n    // because of the transfer delay or connection status. (If gameLoop here fails,\n    // it is recovered by the callback gameLoop which is called after peer input received.)\n    // Now the rendering is delayed 40ms (when pikaVolley.normalFPS == 25)\n    // behind gameLoop.\n    renderer.render(app.view);\n    pikaVolley.gameLoop();\n  });\n  ticker.start();\n}\n","import * as PIXI from 'pixi.js-legacy';\n\nconst APP_VIEW_WIDTH = 480;\nconst APP_VIEW_HEIGHT = 800;\n\nconst STAGE_WIDTH = 432;\nconst STAGE_HEIGHT = 304;\n\nexport class App {\n  constructor(renderer, stage, gamePad) {\n    this.renderer = renderer;\n\n    this.view = new PIXI.Container();\n    this.initApp();\n\n    this.stage = stage;\n    this.initStage();\n    this.view.addChild(this.stage);\n\n    this.gamepad = gamePad;\n    this.initGamepad();\n    this.view.addChild(this.gamepad);\n\n    window.appView = this.view;\n  }\n\n  initStage() {\n    const background = new PIXI.Graphics();\n    background.beginFill(0x000000);\n    background.drawRect(0, 0, STAGE_WIDTH, STAGE_HEIGHT);\n    this.stage.addChild(background);\n\n    const scale = APP_VIEW_WIDTH / STAGE_WIDTH;\n\n    this.stage.scale.x = scale;\n    this.stage.scale.y = scale;\n  }\n\n  initGamepad() {\n    this.gamepad.x = 0;\n    this.gamepad.y = this.stage.height;\n  }\n\n  initApp() {\n    const background = new PIXI.Graphics();\n    background.beginFill(0x000000);\n    background.drawRect(0, 0, APP_VIEW_WIDTH, APP_VIEW_HEIGHT);\n    this.view.addChild(background);\n\n    if (this.renderer.width > this.renderer.height) {\n      const scale = this.renderer.height / APP_VIEW_HEIGHT;\n\n      this.view.scale.x = scale;\n      this.view.scale.y = scale;\n\n      this.view.x = this.renderer.width / 2 - this.view.width / 2;\n      this.view.y = 0;\n\n      this.mask = new PIXI.Graphics();\n      this.mask.beginFill(0xffffff);\n      this.mask.drawRect(\n        this.view.x,\n        this.view.y,\n        this.view.width,\n        this.view.height\n      );\n      this.view.mask = this.mask;\n    } else {\n      this.view.height =\n        (APP_VIEW_HEIGHT * this.renderer.width) / APP_VIEW_WIDTH;\n      this.view.width = this.renderer.width;\n    }\n  }\n}\n","/* Font Face Observer v2.1.0 - © Bram Stein. License: BSD-3-Clause */(function(){function l(a,b){document.addEventListener?a.addEventListener(\"scroll\",b,!1):a.attachEvent(\"scroll\",b)}function m(a){document.body?a():document.addEventListener?document.addEventListener(\"DOMContentLoaded\",function c(){document.removeEventListener(\"DOMContentLoaded\",c);a()}):document.attachEvent(\"onreadystatechange\",function k(){if(\"interactive\"==document.readyState||\"complete\"==document.readyState)document.detachEvent(\"onreadystatechange\",k),a()})};function t(a){this.a=document.createElement(\"div\");this.a.setAttribute(\"aria-hidden\",\"true\");this.a.appendChild(document.createTextNode(a));this.b=document.createElement(\"span\");this.c=document.createElement(\"span\");this.h=document.createElement(\"span\");this.f=document.createElement(\"span\");this.g=-1;this.b.style.cssText=\"max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;\";this.c.style.cssText=\"max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;\";\nthis.f.style.cssText=\"max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;\";this.h.style.cssText=\"display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;\";this.b.appendChild(this.h);this.c.appendChild(this.f);this.a.appendChild(this.b);this.a.appendChild(this.c)}\nfunction u(a,b){a.a.style.cssText=\"max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:\"+b+\";\"}function z(a){var b=a.a.offsetWidth,c=b+100;a.f.style.width=c+\"px\";a.c.scrollLeft=c;a.b.scrollLeft=a.b.scrollWidth+100;return a.g!==b?(a.g=b,!0):!1}function A(a,b){function c(){var a=k;z(a)&&a.a.parentNode&&b(a.g)}var k=a;l(a.b,c);l(a.c,c);z(a)};function B(a,b){var c=b||{};this.family=a;this.style=c.style||\"normal\";this.weight=c.weight||\"normal\";this.stretch=c.stretch||\"normal\"}var C=null,D=null,E=null,F=null;function G(){if(null===D)if(J()&&/Apple/.test(window.navigator.vendor)){var a=/AppleWebKit\\/([0-9]+)(?:\\.([0-9]+))(?:\\.([0-9]+))/.exec(window.navigator.userAgent);D=!!a&&603>parseInt(a[1],10)}else D=!1;return D}function J(){null===F&&(F=!!document.fonts);return F}\nfunction K(){if(null===E){var a=document.createElement(\"div\");try{a.style.font=\"condensed 100px sans-serif\"}catch(b){}E=\"\"!==a.style.font}return E}function L(a,b){return[a.style,a.weight,K()?a.stretch:\"\",\"100px\",b].join(\" \")}\nB.prototype.load=function(a,b){var c=this,k=a||\"BESbswy\",r=0,n=b||3E3,H=(new Date).getTime();return new Promise(function(a,b){if(J()&&!G()){var M=new Promise(function(a,b){function e(){(new Date).getTime()-H>=n?b(Error(\"\"+n+\"ms timeout exceeded\")):document.fonts.load(L(c,'\"'+c.family+'\"'),k).then(function(c){1<=c.length?a():setTimeout(e,25)},b)}e()}),N=new Promise(function(a,c){r=setTimeout(function(){c(Error(\"\"+n+\"ms timeout exceeded\"))},n)});Promise.race([N,M]).then(function(){clearTimeout(r);a(c)},\nb)}else m(function(){function v(){var b;if(b=-1!=f&&-1!=g||-1!=f&&-1!=h||-1!=g&&-1!=h)(b=f!=g&&f!=h&&g!=h)||(null===C&&(b=/AppleWebKit\\/([0-9]+)(?:\\.([0-9]+))/.exec(window.navigator.userAgent),C=!!b&&(536>parseInt(b[1],10)||536===parseInt(b[1],10)&&11>=parseInt(b[2],10))),b=C&&(f==w&&g==w&&h==w||f==x&&g==x&&h==x||f==y&&g==y&&h==y)),b=!b;b&&(d.parentNode&&d.parentNode.removeChild(d),clearTimeout(r),a(c))}function I(){if((new Date).getTime()-H>=n)d.parentNode&&d.parentNode.removeChild(d),b(Error(\"\"+\nn+\"ms timeout exceeded\"));else{var a=document.hidden;if(!0===a||void 0===a)f=e.a.offsetWidth,g=p.a.offsetWidth,h=q.a.offsetWidth,v();r=setTimeout(I,50)}}var e=new t(k),p=new t(k),q=new t(k),f=-1,g=-1,h=-1,w=-1,x=-1,y=-1,d=document.createElement(\"div\");d.dir=\"ltr\";u(e,L(c,\"sans-serif\"));u(p,L(c,\"serif\"));u(q,L(c,\"monospace\"));d.appendChild(e.a);d.appendChild(p.a);d.appendChild(q.a);document.body.appendChild(d);w=e.a.offsetWidth;x=p.a.offsetWidth;y=q.a.offsetWidth;I();A(e,function(a){f=a;v()});u(e,\nL(c,'\"'+c.family+'\",sans-serif'));A(p,function(a){g=a;v()});u(p,L(c,'\"'+c.family+'\",serif'));A(q,function(a){h=a;v()});u(q,L(c,'\"'+c.family+'\",monospace'))})})};\"object\"===typeof module?module.exports=B:(window.FontFaceObserver=B,window.FontFaceObserver.prototype.load=B.prototype.load);}());\n"],"sourceRoot":""}